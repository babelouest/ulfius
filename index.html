<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ulfius: Ulfius API Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ulfius
   </div>
   <div id="projectbrief">HTTP Framework for REST Applications in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ulfius API Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_API"></a></p><ul>
<li><a href="#use-ulfius-in-a-c-program">Use Ulfius in a C program</a><ul>
<li><a href="#header-file">Header file</a></li>
<li><a href="#build-options">Build options</a></li>
</ul>
</li>
<li><a href="#return-values">Return values</a></li>
<li><a href="#memory-management">Memory management</a></li>
<li><a href="#webservice-initialization">Webservice initialization</a><ul>
<li><a href="#instance-structure">Instance structure</a></li>
<li><a href="#endpoint-structure">Endpoint structure</a></li>
<li><a href="#multiple-callback-functions">Multiple callback functions</a></li>
<li><a href="#multiple-urls-with-similar-pattern">Multiple URLs with similar pattern</a></li>
</ul>
</li>
<li><a href="#start-and-stop-webservice">Start and stop webservice</a></li>
<li><a href="#callback-functions-management">Callback functions management</a><ul>
<li><a href="#request-structure">Request structure</a><ul>
<li><a href="#ulfius_set_request_properties">ulfius_set_request_properties</a></li>
</ul>
</li>
<li><a href="#response-structure">Response structure</a><ul>
<li><a href="#ulfius_set_response_properties">ulfius_set_response_properties</a></li>
</ul>
</li>
<li><a href="#callback-functions-return-value">Callback functions return value</a></li>
<li><a href="#use-json-in-request-and-response-body">Use JSON in request and response body</a></li>
<li><a href="#additional-functions">Additional functions</a></li>
<li><a href="#memory-management">Memory management</a></li>
<li><a href="#character-encoding">Character encoding</a></li>
<li><a href="#accessing-post-parameters">Accessing POST parameters</a></li>
<li><a href="#accessing-query-string-and-url-parameters">Accessing query string and URL parameters</a></li>
<li><a href="#accessing-header-parameters">Accessing header parameters</a></li>
<li><a href="#cookie-management">Cookie management</a></li>
<li><a href="#file-upload">File upload</a><ul>
<li><a href="#binary-file-upload">Binary file upload</a></li>
</ul>
</li>
<li><a href="#streaming-data">Streaming data</a></li>
<li><a href="#websockets-communication">Websockets communication</a><ul>
<li><a href="#websocket-management">Websocket management</a></li>
<li><a href="#messages-manipulation">Messages manipulation</a></li>
<li><a href="#server-side-websocket">Server-side websocket</a><ul>
<li><a href="#open-a-websocket-communication">Open a websocket communication</a></li>
<li><a href="#advanced-websocket-extension">Advanced websocket extension</a></li>
<li><a href="#built-in-server-extension-permessage-deflate">Built-in server extension permessage-deflate</a></li>
<li><a href="#close-a-websocket-communication">Close a websocket communication</a></li>
<li><a href="#websocket-status">Websocket status</a></li>
</ul>
</li>
<li><a href="#client-side-websocket">Client-side websocket</a><ul>
<li><a href="#prepare-the-request">Prepare the request</a></li>
<li><a href="#built-in-client-extension-permessage-deflate">Built-in client extension permessage-deflate</a></li>
<li><a href="#open-the-websocket">Open the websocket</a></li>
<li><a href="#client-websocket-status">Client Websocket status</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#outgoing-request-functions">Outgoing request functions</a><ul>
<li><a href="#send-http-request-api">Send HTTP request API</a></li>
<li><a href="#send-http-request-api">Send SMTP request API</a></li>
</ul>
</li>
<li><a href="#struct-_u_map-api">struct _u_map API</a></li>
<li><a href="#whats-new-in-ulfius-27">What's new in Ulfius 2.7?</a></li>
<li><a href="#whats-new-in-ulfius-26">What's new in Ulfius 2.6?</a></li>
<li><a href="#whats-new-in-ulfius-25">What's new in Ulfius 2.5?</a></li>
<li><a href="#whats-new-in-ulfius-24">What's new in Ulfius 2.4?</a></li>
<li><a href="#whats-new-in-ulfius-23">What's new in Ulfius 2.3?</a></li>
<li><a href="#whats-new-in-ulfius-22">What's new in Ulfius 2.2?</a></li>
<li><a href="#whats-new-in-ulfius-21">What's new in Ulfius 2.1?</a></li>
<li><a href="#whats-new-in-ulfius-20">What's new in Ulfius 2.0?</a><ul>
<li><a href="#multiple-callback-functions-1">Multiple callback functions</a></li>
<li><a href="#keep-only-binary_body-in-struct-_u_request-and-struct-_u_response">Keep only binary_body in struct _u_request and struct _u_response</a></li>
<li><a href="#websocket-service">Websocket service</a></li>
<li><a href="#remove-libjansson-and-libcurl-hard-dependency">Remove libjansson and libcurl hard dependency</a></li>
<li><a href="#ready-to-use-callback-functions">Ready-to-use callback functions</a></li>
</ul>
</li>
<li><a href="#update-existing-programs-from-ulfius-20-to-21">Update existing programs from Ulfius 2.0 to 2.1</a></li>
<li><a href="#update-existing-programs-from-ulfius-1x-to-20">Update existing programs from Ulfius 1.x to 2.0</a></li>
</ul>
<h1>Use Ulfius in a C program <a class="anchor" id="use-ulfius-in-a-c-program"></a></h1>
<h2>Header file <a class="anchor" id="header-file"></a></h2>
<p>Include file <code><a class="el" href="ulfius_8h.html" title="Ulfius framework.">ulfius.h</a></code> in your source file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ulfius_8h.html">ulfius.h</a>&gt;</span></div>
<div class="ttc" id="aulfius_8h_html"><div class="ttname"><a href="ulfius_8h.html">ulfius.h</a></div><div class="ttdoc">Ulfius framework.</div></div>
</div><!-- fragment --><h2>Build options <a class="anchor" id="build-options"></a></h2>
<p>You can use <code>pkg-config</code> to provide the compile and link options for Ulfius:</p>
<div class="fragment"><div class="line">$ # compile flags</div>
<div class="line">$ pkg-config --cflags libulfius</div>
<div class="line">-I/usr/include</div>
<div class="line">$ # linker flags</div>
<div class="line">$ pkg-config --libs libulfius</div>
<div class="line">-L/usr/lib -lulfius -lorcania -lyder</div>
</div><!-- fragment --><p>If you don't or can't have pkg-config for the build, you can set the linker options <code>-lulfius -lorcania -lyder</code>.</p>
<p>The options <code>-lorcania</code> and <code>-lyder</code> are not necessary if you don't directly use Orcania or Yder functions. But in doubt, add them anyway.</p>
<p>On your linker command, add Ulfius as a dependency library, e.g. <code>-lulfius</code> for gcc.</p>
<h1>Return values <a class="anchor" id="return-values"></a></h1>
<p>When specified, some functions return <code>U_OK</code> on success, and other values otherwise. <code>U_OK</code> is 0, other values are non-0 values. The defined return value list is the following: </p><div class="fragment"><div class="line"><span class="preprocessor">#define U_OK                 0 </span><span class="comment">// No error</span></div>
<div class="line"><span class="preprocessor">#define U_ERROR              1 </span><span class="comment">// Error</span></div>
<div class="line"><span class="preprocessor">#define U_ERROR_MEMORY       2 </span><span class="comment">// Error in memory allocation</span></div>
<div class="line"><span class="preprocessor">#define U_ERROR_PARAMS       3 </span><span class="comment">// Error in input parameters</span></div>
<div class="line"><span class="preprocessor">#define U_ERROR_LIBMHD       4 </span><span class="comment">// Error in libmicrohttpd execution</span></div>
<div class="line"><span class="preprocessor">#define U_ERROR_LIBCURL      5 </span><span class="comment">// Error in libcurl execution</span></div>
<div class="line">#define U_ERROR_NOT_FOUND    6 <span class="comment">// Something was not found</span></div>
</div><!-- fragment --><h1>Memory management <a class="anchor" id="memory-management"></a></h1>
<p>Ulfius uses the memory allocation functions <code>malloc/realloc/calloc/free</code> by default, but you can overwrite this and use any other memory allocation functions of your choice. Use Orcania's functions <code>o_set_alloc_funcs</code> and <code>o_get_alloc_funcs</code> to set and get memory allocation functions.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> o_set_alloc_funcs(o_malloc_t malloc_fn, o_realloc_t realloc_fn, o_free_t free_fn);</div>
<div class="line"><span class="keywordtype">void</span> o_get_alloc_funcs(o_malloc_t * malloc_fn, o_realloc_t * realloc_fn, o_free_t * free_fn);</div>
</div><!-- fragment --><p>Accessing those functions requires you to directly link your application also against the Orcania library. To do so, add <code>-lorcania</code> to your linking command.</p>
<p>If you use a version of <code>libmicrohttpd</code> older than <code>0.9.61</code>, you need to set the <code>mhd_response_copy_data = 1</code> in your <code><a class="el" href="struct__u__instance.html" title="Contains the needed data for an ulfius instance to work.">_u_instance</a></code> if you use a memory allocator whose allocated return values may not directly be passed to free() or if you want to make sure all free() will always go via your user-provided free callback.</p>
<p>Data structures allocated have their specific cleanup functions. To free pointer allocated, you should use the function <code>u_free</code> that is intended to use your memory management functions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__instance.html#ga413aed1e9e53e4a6d69646bd386dab28">ulfius_clean_instance</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga6c5d177fee97aed70b1cda7425e85ed5">ulfius_clean_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga5cd00e853403c70d491412ef8061fdaf">ulfius_clean_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga10cc4ab7d9ac763c5ad796fdb5b16fbd">u_map_clean</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__mem.html#gaac16030b0f6866d51a65015b9fe96f0c">u_free</a>(<span class="keywordtype">void</span> * data);</div>
<div class="ttc" id="agroup__instance_html_ga413aed1e9e53e4a6d69646bd386dab28"><div class="ttname"><a href="group__instance.html#ga413aed1e9e53e4a6d69646bd386dab28">ulfius_clean_instance</a></div><div class="ttdeci">void ulfius_clean_instance(struct _u_instance *u_instance)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1624</div></div>
<div class="ttc" id="agroup__mem_html_gaac16030b0f6866d51a65015b9fe96f0c"><div class="ttname"><a href="group__mem.html#gaac16030b0f6866d51a65015b9fe96f0c">u_free</a></div><div class="ttdeci">void u_free(void *data)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1746</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga5cd00e853403c70d491412ef8061fdaf"><div class="ttname"><a href="group__request__response__cookie.html#ga5cd00e853403c70d491412ef8061fdaf">ulfius_clean_response</a></div><div class="ttdeci">int ulfius_clean_response(struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_response.c:332</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga6c5d177fee97aed70b1cda7425e85ed5"><div class="ttname"><a href="group__request__response__cookie.html#ga6c5d177fee97aed70b1cda7425e85ed5">ulfius_clean_request</a></div><div class="ttdeci">int ulfius_clean_request(struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:323</div></div>
<div class="ttc" id="agroup__u__map_html_ga10cc4ab7d9ac763c5ad796fdb5b16fbd"><div class="ttname"><a href="group__u__map.html#ga10cc4ab7d9ac763c5ad796fdb5b16fbd">u_map_clean</a></div><div class="ttdeci">int u_map_clean(struct _u_map *u_map)</div><div class="ttdef"><b>Definition:</b> u_map.c:70</div></div>
<div class="ttc" id="astruct__u__instance_html"><div class="ttname"><a href="struct__u__instance.html">_u_instance</a></div><div class="ttdoc">Contains the needed data for an ulfius instance to work.</div><div class="ttdef"><b>Definition:</b> ulfius.h:316</div></div>
<div class="ttc" id="astruct__u__map_html"><div class="ttname"><a href="struct__u__map.html">_u_map</a></div><div class="ttdef"><b>Definition:</b> ulfius.h:204</div></div>
<div class="ttc" id="astruct__u__request_html"><div class="ttname"><a href="struct__u__request.html">_u_request</a></div><div class="ttdoc">definition of the parameters available in a struct _u_request</div><div class="ttdef"><b>Definition:</b> ulfius.h:233</div></div>
<div class="ttc" id="astruct__u__response_html"><div class="ttname"><a href="struct__u__response.html">_u_response</a></div><div class="ttdoc">definition of the parameters available in a struct _u_response</div><div class="ttdef"><b>Definition:</b> ulfius.h:273</div></div>
</div><!-- fragment --><p>It's <b>recommended</b> to use <code>ulfius_global_init</code> and <code>ulfius_global_close</code> at the beginning and at the end of your program to initialize and cleanup internal values and settings. This will make outgoing requests faster, especially if you use lots of them, and dispatch your memory allocation functions in curl and Jansson if you changed them. These functions are <b>NOT</b> thread-safe, so you must use them in a single thread context.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__mem.html#ga7105d513f00375b75fbbcf52f148af63">ulfius_global_init</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__mem.html#ga1dc565b2f0d20b0f19183d9a916b522d">ulfius_global_close</a>();</div>
<div class="ttc" id="agroup__mem_html_ga1dc565b2f0d20b0f19183d9a916b522d"><div class="ttname"><a href="group__mem.html#ga1dc565b2f0d20b0f19183d9a916b522d">ulfius_global_close</a></div><div class="ttdeci">void ulfius_global_close(void)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1930</div></div>
<div class="ttc" id="agroup__mem_html_ga7105d513f00375b75fbbcf52f148af63"><div class="ttname"><a href="group__mem.html#ga7105d513f00375b75fbbcf52f148af63">ulfius_global_init</a></div><div class="ttdeci">int ulfius_global_init(void)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1906</div></div>
</div><!-- fragment --><h1>Webservice initialization <a class="anchor" id="webservice-initialization"></a></h1>
<p>Ulfius framework runs as an async task in the background. When initialized, a thread is executed in the background. This thread will listen to the specified port and dispatch the calls to the specified callback functions. Ulfius allows adding and removing new endpoints during the instance execution.</p>
<p>To run a webservice, you must initialize a <code>struct <a class="el" href="struct__u__instance.html" title="Contains the needed data for an ulfius instance to work.">_u_instance</a></code> and add your endpoints.</p>
<h2>Instance structure <a class="anchor" id="instance-structure"></a></h2>
<p>The <code>struct <a class="el" href="struct__u__instance.html" title="Contains the needed data for an ulfius instance to work.">_u_instance</a></code> is defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__instance.html">_u_instance</a> {</div>
<div class="line">  <span class="keyword">struct </span>MHD_Daemon          *  <a class="code" href="struct__u__instance.html#a254dcc6e96ffa013de44382b3f5bc7f4">mhd_daemon</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#a233a51ae1b61b62a693770484740e469">status</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                  <a class="code" href="struct__u__instance.html#a42957e664dbef6fc36278b84758789dd">port</a>;</div>
<div class="line"><span class="preprocessor">#if MHD_VERSION &gt;= 0x00095208</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>                network_type;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="keyword">struct </span>sockaddr_in          * <a class="code" href="struct__u__instance.html#a6d9c92a91d589d7e01a1175b0ad510a2">bind_address</a>;</div>
<div class="line">  <span class="keyword">struct </span>sockaddr_in6         * <a class="code" href="struct__u__instance.html#a8bd70f0b2d7a66cba3c379268e46f2bb">bind_address6</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                  <a class="code" href="struct__u__instance.html#a5160449171633bd9ccaf12b2049a53e2">timeout</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#a985f6cb0a0aababca6d42bc5ed47403a">nb_endpoints</a>;</div>
<div class="line">  <span class="keywordtype">char</span>                        * <a class="code" href="struct__u__instance.html#ae49d989d6178ba5f6a9375f9e617d45c">default_auth_realm</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__endpoint.html">_u_endpoint</a>          * <a class="code" href="struct__u__instance.html#a9753b7a56bd0633ed673a03afbd9bbce">endpoint_list</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__endpoint.html">_u_endpoint</a>          * <a class="code" href="struct__u__instance.html#acb83ece8985c90990f050208e9de7fc8">default_endpoint</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a>               * <a class="code" href="struct__u__instance.html#a783f21593f49591d4d61756ab7784e8e">default_headers</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span>                        <a class="code" href="struct__u__instance.html#a24a5d7e3bda73eb7f5d5427b8606b12a">max_post_param_size</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span>                        <a class="code" href="struct__u__instance.html#a52a3526eb457225aeec2cbb4da324041">max_post_body_size</a>;</div>
<div class="line">  <span class="keywordtype">void</span>                        * <a class="code" href="struct__u__instance.html#ad018dc3a7cbee528cc67612f4a8451ae">websocket_handler</a>;</div>
<div class="line">  int                        (* <a class="code" href="struct__u__instance.html#ae26d2bd785194f1676f54e625a4c0ac2">file_upload_callback</a>) (<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct__u__request.html">_u_request</a> * request, </div>
<div class="line">                                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * key, </div>
<div class="line">                                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * filename, </div>
<div class="line">                                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * content_type, </div>
<div class="line">                                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * transfer_encoding, </div>
<div class="line">                                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * data, </div>
<div class="line">                                                       uint64_t off, </div>
<div class="line">                                                       <span class="keywordtype">size_t</span> size, </div>
<div class="line">                                                       <span class="keywordtype">void</span> * cls);</div>
<div class="line">  <span class="keywordtype">void</span>                        * <a class="code" href="struct__u__instance.html#a75760dc56138dab90630401d8286010d">file_upload_cls</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#ae642bdcab01c2d537d0e6ff1f6924d4e">mhd_response_copy_data</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#a8199ebaf5638f6d370172a596f466d68">check_utf8</a>;</div>
<div class="line"><span class="preprocessor">#ifndef U_DISABLE_GNUTLS</span></div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#af141bc558137d4df99bceab94c627447">use_client_cert_auth</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="keywordtype">int</span>                           <a class="code" href="struct__u__instance.html#a32d50bf325d4de3a42755efe510318f1">allowed_post_processor</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__u__endpoint_html"><div class="ttname"><a href="struct__u__endpoint.html">_u_endpoint</a></div><div class="ttdoc">Contains all informations needed for an endpoint.</div><div class="ttdef"><b>Definition:</b> ulfius.h:299</div></div>
<div class="ttc" id="astruct__u__instance_html_a233a51ae1b61b62a693770484740e469"><div class="ttname"><a href="struct__u__instance.html#a233a51ae1b61b62a693770484740e469">_u_instance::status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> ulfius.h:318</div></div>
<div class="ttc" id="astruct__u__instance_html_a24a5d7e3bda73eb7f5d5427b8606b12a"><div class="ttname"><a href="struct__u__instance.html#a24a5d7e3bda73eb7f5d5427b8606b12a">_u_instance::max_post_param_size</a></div><div class="ttdeci">size_t max_post_param_size</div><div class="ttdef"><b>Definition:</b> ulfius.h:331</div></div>
<div class="ttc" id="astruct__u__instance_html_a254dcc6e96ffa013de44382b3f5bc7f4"><div class="ttname"><a href="struct__u__instance.html#a254dcc6e96ffa013de44382b3f5bc7f4">_u_instance::mhd_daemon</a></div><div class="ttdeci">struct MHD_Daemon * mhd_daemon</div><div class="ttdef"><b>Definition:</b> ulfius.h:317</div></div>
<div class="ttc" id="astruct__u__instance_html_a32d50bf325d4de3a42755efe510318f1"><div class="ttname"><a href="struct__u__instance.html#a32d50bf325d4de3a42755efe510318f1">_u_instance::allowed_post_processor</a></div><div class="ttdeci">int allowed_post_processor</div><div class="ttdef"><b>Definition:</b> ulfius.h:349</div></div>
<div class="ttc" id="astruct__u__instance_html_a42957e664dbef6fc36278b84758789dd"><div class="ttname"><a href="struct__u__instance.html#a42957e664dbef6fc36278b84758789dd">_u_instance::port</a></div><div class="ttdeci">unsigned int port</div><div class="ttdef"><b>Definition:</b> ulfius.h:319</div></div>
<div class="ttc" id="astruct__u__instance_html_a5160449171633bd9ccaf12b2049a53e2"><div class="ttname"><a href="struct__u__instance.html#a5160449171633bd9ccaf12b2049a53e2">_u_instance::timeout</a></div><div class="ttdeci">unsigned int timeout</div><div class="ttdef"><b>Definition:</b> ulfius.h:325</div></div>
<div class="ttc" id="astruct__u__instance_html_a52a3526eb457225aeec2cbb4da324041"><div class="ttname"><a href="struct__u__instance.html#a52a3526eb457225aeec2cbb4da324041">_u_instance::max_post_body_size</a></div><div class="ttdeci">size_t max_post_body_size</div><div class="ttdef"><b>Definition:</b> ulfius.h:332</div></div>
<div class="ttc" id="astruct__u__instance_html_a6d9c92a91d589d7e01a1175b0ad510a2"><div class="ttname"><a href="struct__u__instance.html#a6d9c92a91d589d7e01a1175b0ad510a2">_u_instance::bind_address</a></div><div class="ttdeci">struct sockaddr_in * bind_address</div><div class="ttdef"><b>Definition:</b> ulfius.h:323</div></div>
<div class="ttc" id="astruct__u__instance_html_a75760dc56138dab90630401d8286010d"><div class="ttname"><a href="struct__u__instance.html#a75760dc56138dab90630401d8286010d">_u_instance::file_upload_cls</a></div><div class="ttdeci">void * file_upload_cls</div><div class="ttdef"><b>Definition:</b> ulfius.h:343</div></div>
<div class="ttc" id="astruct__u__instance_html_a783f21593f49591d4d61756ab7784e8e"><div class="ttname"><a href="struct__u__instance.html#a783f21593f49591d4d61756ab7784e8e">_u_instance::default_headers</a></div><div class="ttdeci">struct _u_map * default_headers</div><div class="ttdef"><b>Definition:</b> ulfius.h:330</div></div>
<div class="ttc" id="astruct__u__instance_html_a8199ebaf5638f6d370172a596f466d68"><div class="ttname"><a href="struct__u__instance.html#a8199ebaf5638f6d370172a596f466d68">_u_instance::check_utf8</a></div><div class="ttdeci">int check_utf8</div><div class="ttdef"><b>Definition:</b> ulfius.h:345</div></div>
<div class="ttc" id="astruct__u__instance_html_a8bd70f0b2d7a66cba3c379268e46f2bb"><div class="ttname"><a href="struct__u__instance.html#a8bd70f0b2d7a66cba3c379268e46f2bb">_u_instance::bind_address6</a></div><div class="ttdeci">struct sockaddr_in6 * bind_address6</div><div class="ttdef"><b>Definition:</b> ulfius.h:324</div></div>
<div class="ttc" id="astruct__u__instance_html_a9753b7a56bd0633ed673a03afbd9bbce"><div class="ttname"><a href="struct__u__instance.html#a9753b7a56bd0633ed673a03afbd9bbce">_u_instance::endpoint_list</a></div><div class="ttdeci">struct _u_endpoint * endpoint_list</div><div class="ttdef"><b>Definition:</b> ulfius.h:328</div></div>
<div class="ttc" id="astruct__u__instance_html_a985f6cb0a0aababca6d42bc5ed47403a"><div class="ttname"><a href="struct__u__instance.html#a985f6cb0a0aababca6d42bc5ed47403a">_u_instance::nb_endpoints</a></div><div class="ttdeci">int nb_endpoints</div><div class="ttdef"><b>Definition:</b> ulfius.h:326</div></div>
<div class="ttc" id="astruct__u__instance_html_acb83ece8985c90990f050208e9de7fc8"><div class="ttname"><a href="struct__u__instance.html#acb83ece8985c90990f050208e9de7fc8">_u_instance::default_endpoint</a></div><div class="ttdeci">struct _u_endpoint * default_endpoint</div><div class="ttdef"><b>Definition:</b> ulfius.h:329</div></div>
<div class="ttc" id="astruct__u__instance_html_ad018dc3a7cbee528cc67612f4a8451ae"><div class="ttname"><a href="struct__u__instance.html#ad018dc3a7cbee528cc67612f4a8451ae">_u_instance::websocket_handler</a></div><div class="ttdeci">void * websocket_handler</div><div class="ttdef"><b>Definition:</b> ulfius.h:333</div></div>
<div class="ttc" id="astruct__u__instance_html_ae26d2bd785194f1676f54e625a4c0ac2"><div class="ttname"><a href="struct__u__instance.html#ae26d2bd785194f1676f54e625a4c0ac2">_u_instance::file_upload_callback</a></div><div class="ttdeci">int(* file_upload_callback)(const struct _u_request *request, const char *key, const char *filename, const char *content_type, const char *transfer_encoding, const char *data, uint64_t off, size_t size, void *cls)</div><div class="ttdef"><b>Definition:</b> ulfius.h:334</div></div>
<div class="ttc" id="astruct__u__instance_html_ae49d989d6178ba5f6a9375f9e617d45c"><div class="ttname"><a href="struct__u__instance.html#ae49d989d6178ba5f6a9375f9e617d45c">_u_instance::default_auth_realm</a></div><div class="ttdeci">char * default_auth_realm</div><div class="ttdef"><b>Definition:</b> ulfius.h:327</div></div>
<div class="ttc" id="astruct__u__instance_html_ae642bdcab01c2d537d0e6ff1f6924d4e"><div class="ttname"><a href="struct__u__instance.html#ae642bdcab01c2d537d0e6ff1f6924d4e">_u_instance::mhd_response_copy_data</a></div><div class="ttdeci">int mhd_response_copy_data</div><div class="ttdef"><b>Definition:</b> ulfius.h:344</div></div>
<div class="ttc" id="astruct__u__instance_html_af141bc558137d4df99bceab94c627447"><div class="ttname"><a href="struct__u__instance.html#af141bc558137d4df99bceab94c627447">_u_instance::use_client_cert_auth</a></div><div class="ttdeci">int use_client_cert_auth</div><div class="ttdef"><b>Definition:</b> ulfius.h:347</div></div>
</div><!-- fragment --><p>In the <code>struct <a class="el" href="struct__u__instance.html" title="Contains the needed data for an ulfius instance to work.">_u_instance</a></code> structure, the element <code>port</code> must be set to the port number you want to listen to, the element <code>bind_address</code> is used if you want to listen only to a specific IP address. The element <code>mhd_daemon</code> is used by the framework, don't modify it.</p>
<p>You can use the functions <code>ulfius_init_instance</code>, <code>ulfius_init_instance_ipv6</code> and <code>ulfius_clean_instance</code> to facilitate the manipulation of the structure:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#ga2d14cdd9291b8b8e9d46b1af8fd3b4a8">ulfius_init_instance</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port, <span class="keyword">struct</span> sockaddr_in * bind_address, <span class="keyword">const</span> <span class="keywordtype">char</span> * default_auth_realm);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ulfius_init_instance_ipv6(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port, <span class="keyword">struct</span> sockaddr_in6 * bind_address, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> network_type, <span class="keyword">const</span> <span class="keywordtype">char</span> * default_auth_realm);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__instance.html#ga413aed1e9e53e4a6d69646bd386dab28">ulfius_clean_instance</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance);</div>
<div class="ttc" id="agroup__instance_html_ga2d14cdd9291b8b8e9d46b1af8fd3b4a8"><div class="ttname"><a href="group__instance.html#ga2d14cdd9291b8b8e9d46b1af8fd3b4a8">ulfius_init_instance</a></div><div class="ttdeci">int ulfius_init_instance(struct _u_instance *u_instance, unsigned int port, struct sockaddr_in *bind_address, const char *default_auth_realm)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1732</div></div>
</div><!-- fragment --><p>Since Ulfius 2.6, you can bind to IPv4 connections, IPv6 or both. By default, <code>ulfius_init_instance</code> binds to IPv4 addresses only. If you want to bind to both IPv4 and IPv6 addresses, use <code>ulfius_init_instance_ipv6</code> with the value parameter <code>network_type</code> set to <code>U_USE_ALL</code>. If you want to bind to IPv6 addresses only, use <code>ulfius_init_instance_ipv6</code> with the value parameter <code>network_type</code> set to <code>U_USE_IPV6</code>.</p>
<p>If you bind your instance to an address, you <b>MUST</b> set the port number to <code>struct sockaddr_in.sport</code> because the <code>struct <a class="el" href="struct__u__instance.html#a42957e664dbef6fc36278b84758789dd">_u_instance.port</a></code> will be ignored.</p>
<h2>Endpoint structure <a class="anchor" id="endpoint-structure"></a></h2>
<p>The <code>struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a></code> is defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__endpoint.html">_u_endpoint</a> {</div>
<div class="line">  <span class="keywordtype">char</span>       * <a class="code" href="struct__u__endpoint.html#a7ba40273a0f89467ed1414d0a702e667">http_method</a>;</div>
<div class="line">  <span class="keywordtype">char</span>       * <a class="code" href="struct__u__endpoint.html#ac136cdcf5d0da3568f4ef812f25aeff5">url_prefix</a>;</div>
<div class="line">  <span class="keywordtype">char</span>       * <a class="code" href="struct__u__endpoint.html#a9035f467fc9c1e46834bc3681774f455">url_format</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct__u__endpoint.html#a71c44e93b2197c2411b290adbfc35a20">priority</a>;</div>
<div class="line">  int       (* <a class="code" href="struct__u__endpoint.html#a12ce14f724104739913f6c957c927875">callback_function</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="comment">// Input parameters (set by the framework)</span></div>
<div class="line">                            <span class="keyword">struct </span><a class="code" href="struct__u__response.html">_u_response</a> * response,     <span class="comment">// Output parameters (set by the user)</span></div>
<div class="line">                            <span class="keywordtype">void</span> * <a class="code" href="struct__u__endpoint.html#a192cb45d88869513d03619fa5117f4b6">user_data</a>);</div>
<div class="line">  <span class="keywordtype">void</span>       * <a class="code" href="struct__u__endpoint.html#a192cb45d88869513d03619fa5117f4b6">user_data</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__u__endpoint_html_a12ce14f724104739913f6c957c927875"><div class="ttname"><a href="struct__u__endpoint.html#a12ce14f724104739913f6c957c927875">_u_endpoint::callback_function</a></div><div class="ttdeci">int(* callback_function)(const struct _u_request *request, struct _u_response *response, void *user_data)</div><div class="ttdef"><b>Definition:</b> ulfius.h:304</div></div>
<div class="ttc" id="astruct__u__endpoint_html_a192cb45d88869513d03619fa5117f4b6"><div class="ttname"><a href="struct__u__endpoint.html#a192cb45d88869513d03619fa5117f4b6">_u_endpoint::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> ulfius.h:307</div></div>
<div class="ttc" id="astruct__u__endpoint_html_a71c44e93b2197c2411b290adbfc35a20"><div class="ttname"><a href="struct__u__endpoint.html#a71c44e93b2197c2411b290adbfc35a20">_u_endpoint::priority</a></div><div class="ttdeci">unsigned int priority</div><div class="ttdef"><b>Definition:</b> ulfius.h:303</div></div>
<div class="ttc" id="astruct__u__endpoint_html_a7ba40273a0f89467ed1414d0a702e667"><div class="ttname"><a href="struct__u__endpoint.html#a7ba40273a0f89467ed1414d0a702e667">_u_endpoint::http_method</a></div><div class="ttdeci">char * http_method</div><div class="ttdef"><b>Definition:</b> ulfius.h:300</div></div>
<div class="ttc" id="astruct__u__endpoint_html_a9035f467fc9c1e46834bc3681774f455"><div class="ttname"><a href="struct__u__endpoint.html#a9035f467fc9c1e46834bc3681774f455">_u_endpoint::url_format</a></div><div class="ttdeci">char * url_format</div><div class="ttdef"><b>Definition:</b> ulfius.h:302</div></div>
<div class="ttc" id="astruct__u__endpoint_html_ac136cdcf5d0da3568f4ef812f25aeff5"><div class="ttname"><a href="struct__u__endpoint.html#ac136cdcf5d0da3568f4ef812f25aeff5">_u_endpoint::url_prefix</a></div><div class="ttdeci">char * url_prefix</div><div class="ttdef"><b>Definition:</b> ulfius.h:301</div></div>
</div><!-- fragment --><p>Some functions help you facilitate endpoints manipulation:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__endpoints.html#ga77f8498d50fbba6e62bcf5faae5541fc">ulfius_add_endpoint</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__endpoint.html">_u_endpoint</a> * u_endpoint);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">char</span> * http_method,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">char</span> * url_prefix,</div>
<div class="line">                               <span class="keyword">const</span> <span class="keywordtype">char</span> * url_format,</div>
<div class="line">                               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> priority,</div>
<div class="line">                               <span class="keywordtype">int</span> (* callback_function)(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="comment">// Input parameters (set by the framework)</span></div>
<div class="line">                                                         <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response,     <span class="comment">// Output parameters (set by the user)</span></div>
<div class="line">                                                         <span class="keywordtype">void</span> * user_data),</div>
<div class="line">                               <span class="keywordtype">void</span> * user_data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__endpoints.html#ga743edee7d4d0b0ebf09334f46251c238">ulfius_add_endpoint_list</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__endpoint.html">_u_endpoint</a> ** u_endpoint_list);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__endpoints.html#ga94167a8e931abfb4f9ca7f28d99f5781">ulfius_remove_endpoint</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__endpoint.html">_u_endpoint</a> * u_endpoint);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__endpoints.html#gae0353385da0c41ea33ba830ea271da44">ulfius_remove_endpoint_by_val</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keywordtype">char</span> * http_method, <span class="keyword">const</span> <span class="keywordtype">char</span> * url_prefix, <span class="keyword">const</span> <span class="keywordtype">char</span> * url_format);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ulfius_set_default_callback_function(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance,</div>
<div class="line">                                         <span class="keywordtype">int</span> (* callback_function)(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data),</div>
<div class="line">                                         <span class="keywordtype">void</span> * user_data);</div>
<div class="ttc" id="agroup__endpoints_html_ga743edee7d4d0b0ebf09334f46251c238"><div class="ttname"><a href="group__endpoints.html#ga743edee7d4d0b0ebf09334f46251c238">ulfius_add_endpoint_list</a></div><div class="ttdeci">int ulfius_add_endpoint_list(struct _u_instance *u_instance, const struct _u_endpoint **u_endpoint_list)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1445</div></div>
<div class="ttc" id="agroup__endpoints_html_ga77f8498d50fbba6e62bcf5faae5541fc"><div class="ttname"><a href="group__endpoints.html#ga77f8498d50fbba6e62bcf5faae5541fc">ulfius_add_endpoint</a></div><div class="ttdeci">int ulfius_add_endpoint(struct _u_instance *u_instance, const struct _u_endpoint *u_endpoint)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1405</div></div>
<div class="ttc" id="agroup__endpoints_html_ga94167a8e931abfb4f9ca7f28d99f5781"><div class="ttname"><a href="group__endpoints.html#ga94167a8e931abfb4f9ca7f28d99f5781">ulfius_remove_endpoint</a></div><div class="ttdeci">int ulfius_remove_endpoint(struct _u_instance *u_instance, const struct _u_endpoint *u_endpoint)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1462</div></div>
<div class="ttc" id="agroup__endpoints_html_gae0353385da0c41ea33ba830ea271da44"><div class="ttname"><a href="group__endpoints.html#gae0353385da0c41ea33ba830ea271da44">ulfius_remove_endpoint_by_val</a></div><div class="ttdeci">int ulfius_remove_endpoint_by_val(struct _u_instance *u_instance, const char *http_method, const char *url_prefix, const char *url_format)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1568</div></div>
<div class="ttc" id="agroup__endpoints_html_gae11a1bdc65a5d12a356923332e5f4bbc"><div class="ttname"><a href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a></div><div class="ttdeci">int ulfius_add_endpoint_by_val(struct _u_instance *u_instance, const char *http_method, const char *url_prefix, const char *url_format, unsigned int priority, int(*callback_function)(const struct _u_request *request, struct _u_response *response, void *user_data), void *user_data)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1545</div></div>
</div><!-- fragment --><p>HTTP Method can be an existing or not existing method, or <code>*</code> for any method. You must specify a url_prefix, a url_format or both, callback_function is mandatory, user_data is optional.</p>
<p>If you fill your array of endpoints manually, your <code>struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a></code> array <b>MUST</b> end with an empty <code>struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a></code>.</p>
<p>You can manually declare an endpoint or use the dedicated functions as <code>int ulfius_add_endpoint</code> or <code>int ulfius_add_endpoint_by_val</code>. It's recommended to use the dedicated functions to fill this array though.</p>
<p>If you manipulate the attribute <code>u_instance.endpoint_list</code>, you must end the list with an empty endpoint (see <code>const struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a> * <a class="el" href="group__endpoints.html#gaec6576684b5c0808d07e4a037f7efd05">ulfius_empty_endpoint()</a></code>), and you must set the attribute <code>u_instance.nb_endpoints</code> accordingly. Also, you must use dynamically allocated values (<code>malloc</code>) for attributes <code>http_method</code>, <code>url_prefix</code> and <code>url_format</code>.</p>
<h2>Multiple callback functions <a class="anchor" id="multiple-callback-functions"></a></h2>
<p>Ulfius allows multiple callbacks for the same endpoint. This is helpful when you need to execute several actions in sequence, for example check authentication, get resource, set cookie, then gzip response body. That's also why a priority must be set for each callback.</p>
<p>The priority is in descending order, which means that it starts with 0 (highest priority) and priority decreases when priority number increases. There is no more signification to the priority number, which means you can use any increments of your choice.</p>
<p><code>Warning</code>: Having 2 callback functions with the same priority number will result in an undefined execution order result.</p>
<p>To help passing parameters between callback functions of the same request, the value <code>struct <a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code> can be used. It's recommended to use the function <code>ulfius_set_response_shared_data</code> with a pointer to a free function for <code>shared_data</code>, therefore the framework will automatically clean <code>struct <a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code> at the end of the callback list.</p>
<h2>Multiple URLs with similar pattern <a class="anchor" id="multiple-urls-with-similar-pattern"></a></h2>
<p>If you need to differentiate multiple URLs with similar pattern, you can use priorities among multiple callback function.</p>
<p>For example, if you have 2 endpoints with the following patterns:</p>
<p>1- <code>/example/:id</code> 2- <code>/example/findByStatus</code></p>
<p>You'll probably need the callback referred in 2- to be called and the callback referred in 1- not when the URL called is the exact pattern as in 2-. Nevertheless, you'll need callback referred in 1- in all the other cases.</p>
<p>In that case, you'll have to set a higher priority to the endpoint with the URL 2- and return its callback function with the value <code>U_CALLBACK_COMPLETE</code>. Remember, if the first callback returns <code>U_CALLBACK_CONTINUE</code>, the second callback will be called afterwards.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> callback_example_find_by_status(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  <span class="comment">/* do something here... */</span></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gaac8e292cb32a5bfd70f9312a180837dd">U_CALLBACK_COMPLETE</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> callback_example_by_id(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  <span class="comment">/* do something else there... */</span></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">/* initialize program and instance */</span></div>
<div class="line">  <a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(instance, <span class="stringliteral">&quot;GET&quot;</span>, NULL, <span class="stringliteral">&quot;/example/:id&quot;</span>, 1, &amp;callback_example_by_id, my_user_data);</div>
<div class="line">  <a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(instance, <span class="stringliteral">&quot;GET&quot;</span>, NULL, <span class="stringliteral">&quot;/example/findByStatus&quot;</span>, 0, &amp;callback_example_find_by_status, my_user_data);</div>
<div class="line">  <span class="comment">/* start instance and run program */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__const_html_gaac8e292cb32a5bfd70f9312a180837dd"><div class="ttname"><a href="group__const.html#gaac8e292cb32a5bfd70f9312a180837dd">U_CALLBACK_COMPLETE</a></div><div class="ttdeci">#define U_CALLBACK_COMPLETE</div><div class="ttdoc">Callback exited with success, exit callback list.</div><div class="ttdef"><b>Definition:</b> ulfius.h:121</div></div>
<div class="ttc" id="agroup__const_html_gab603d00690d16137b7cb52b597197a55"><div class="ttname"><a href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a></div><div class="ttdeci">#define U_CALLBACK_CONTINUE</div><div class="ttdoc">Callback exited with success, continue to next callback.</div><div class="ttdef"><b>Definition:</b> ulfius.h:119</div></div>
</div><!-- fragment --><h1>Start and stop webservice <a class="anchor" id="start-and-stop-webservice"></a></h1>
<h2>Start webservice <a class="anchor" id="start-webservice"></a></h2>
<p>The starting point function are <code>ulfius_start_framework</code>, <code>ulfius_start_secure_framework</code>, <code>ulfius_start_secure_ca_trust_framework</code> or <code>ulfius_start_framework_with_mhd_options</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#ga61e97f85ccc5381e4683794de16fbb96">ulfius_start_framework</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#gad8cc6194306edcc0697fc57507941556">ulfius_start_secure_framework</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keywordtype">char</span> * key_pem, <span class="keyword">const</span> <span class="keywordtype">char</span> * cert_pem);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#ga586db642834bb82a598b1f58c1304fd0">ulfius_start_secure_ca_trust_framework</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keyword">const</span> <span class="keywordtype">char</span> * key_pem, <span class="keyword">const</span> <span class="keywordtype">char</span> * cert_pem, <span class="keyword">const</span> <span class="keywordtype">char</span> * root_ca_pem);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#ga4bf7d8e8640a268085d84af4ccae2571">ulfius_start_framework_with_mhd_options</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mhd_flags, <span class="keyword">struct</span> MHD_OptionItem * options);</div>
<div class="ttc" id="agroup__instance_html_ga4bf7d8e8640a268085d84af4ccae2571"><div class="ttname"><a href="group__instance.html#ga4bf7d8e8640a268085d84af4ccae2571">ulfius_start_framework_with_mhd_options</a></div><div class="ttdeci">int ulfius_start_framework_with_mhd_options(struct _u_instance *u_instance, unsigned int mhd_flags, struct MHD_OptionItem *mhd_ops)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1274</div></div>
<div class="ttc" id="agroup__instance_html_ga586db642834bb82a598b1f58c1304fd0"><div class="ttname"><a href="group__instance.html#ga586db642834bb82a598b1f58c1304fd0">ulfius_start_secure_ca_trust_framework</a></div><div class="ttdeci">int ulfius_start_secure_ca_trust_framework(struct _u_instance *u_instance, const char *key_pem, const char *cert_pem, const char *root_ca_pem)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1232</div></div>
<div class="ttc" id="agroup__instance_html_ga61e97f85ccc5381e4683794de16fbb96"><div class="ttname"><a href="group__instance.html#ga61e97f85ccc5381e4683794de16fbb96">ulfius_start_framework</a></div><div class="ttdeci">int ulfius_start_framework(struct _u_instance *u_instance)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1166</div></div>
<div class="ttc" id="agroup__instance_html_gad8cc6194306edcc0697fc57507941556"><div class="ttname"><a href="group__instance.html#gad8cc6194306edcc0697fc57507941556">ulfius_start_secure_framework</a></div><div class="ttdeci">int ulfius_start_secure_framework(struct _u_instance *u_instance, const char *key_pem, const char *cert_pem)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1183</div></div>
</div><!-- fragment --><p>In your program, where you want to start the web server, execute the function <code><a class="el" href="group__instance.html#ga61e97f85ccc5381e4683794de16fbb96">ulfius_start_framework(struct _u_instance * u_instance)</a></code> for a non-secure http connection.</p>
<p>Use the function <code><a class="el" href="group__instance.html#gad8cc6194306edcc0697fc57507941556">ulfius_start_secure_framework(struct _u_instance * u_instance, const char * key_pem, const char * cert_pem)</a></code> for a secure https connection, using a valid private key and a valid corresponding server certificate, see GnuTLS documentation for certificate generation.</p>
<p>Finally, use the function <code>int <a class="el" href="group__instance.html#ga586db642834bb82a598b1f58c1304fd0">ulfius_start_secure_ca_trust_framework(struct _u_instance * u_instance, const char * key_pem, const char * cert_pem, const char * root_ca_pem)</a></code> to start a secure https connection and be able to authenticate clients with a certificate.</p>
<p>Those function accept the previously declared <code>instance</code> as first parameter. You can reuse the same callback function as much as you want for different endpoints. On success, these functions returns <code>U_OK</code>, otherwise an error code.</p>
<p>Note: for security concerns, after running <code>ulfius_start_secure_framework</code> or <code>ulfius_start_secure_ca_trust_framework</code>, you can free the parameters <code>key_pem</code>, <code>cert_pem</code> and <code>root_ca_pem</code> if you want to.</p>
<h2>Stop webservice <a class="anchor" id="stop-webservice"></a></h2>
<p>To stop the webservice, call the following function:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#ga5857450e3610b84284ccd4d8af34144d">ulfius_stop_framework</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance);</div>
<div class="ttc" id="agroup__instance_html_ga5857450e3610b84284ccd4d8af34144d"><div class="ttname"><a href="group__instance.html#ga5857450e3610b84284ccd4d8af34144d">ulfius_stop_framework</a></div><div class="ttdeci">int ulfius_stop_framework(struct _u_instance *u_instance)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1301</div></div>
</div><!-- fragment --><h1>Callback functions management <a class="anchor" id="callback-functions-management"></a></h1>
<p>The callback function is the function executed when a user calls an endpoint managed by your webservice (as defined in your <code>struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a></code> list).</p>
<p>The callback function has the following signature:</p>
<div class="fragment"><div class="line">int (* callback_function)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="comment">// Input parameters (set by the framework)</span></div>
<div class="line">                          <span class="keyword">struct </span><a class="code" href="struct__u__response.html">_u_response</a> * response,     <span class="comment">// Output parameters (set by the user)</span></div>
<div class="line">                          <span class="keywordtype">void</span> * user_data);</div>
</div><!-- fragment --><p>In the callback function definition, the variables <code>request</code> and <code>response</code> will be initialized by the framework, and the <code>user_data</code> variable will be assigned to the user_data defined in your endpoint list definition.</p>
<h2>Request structure <a class="anchor" id="request-structure"></a></h2>
<p>The request variable is defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__request.html">_u_request</a> {</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a1514b0e328911bc647ff5f69cc8f36f8">http_protocol</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#ab4cc108c47b22d03d7cc5338e3439f7d">http_verb</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#ae1b2bb23752f9f54829845b38f7cdeb0">http_url</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a9c8154bb217d7792f8bb08c8f009c2bb">url_path</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#ad6021c5be3e6f214d0eca9134a58e9b1">proxy</a>;</div>
<div class="line"><span class="preprocessor">#if MHD_VERSION &gt;= 0x00095208</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>       network_type;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="keywordtype">int</span>                  <a class="code" href="struct__u__request.html#a62427dbc71d4e59b50bae06a0b93993c">check_server_certificate</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                  <a class="code" href="struct__u__request.html#a0ac04ec6f545468e7c1e47c89a50a677">check_server_certificate_flag</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                  <a class="code" href="struct__u__request.html#a8daf471704c90509e9b673288b9d307e">check_proxy_certificate</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                  <a class="code" href="struct__u__request.html#a219f5178b5fd55d040638298418de0f3">check_proxy_certificate_flag</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                  <a class="code" href="struct__u__request.html#a0d5efa3b4e143e8b624ccee8db515e76">follow_redirect</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a7161541bf0dab12e76b6651b8184251e">ca_path</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>        <a class="code" href="struct__u__request.html#a075f18af2cb3d2e4db3072793b2f3ae3">timeout</a>;</div>
<div class="line">  <span class="keyword">struct </span>sockaddr *    <a class="code" href="struct__u__request.html#a6a8d20bca41838f50ad359c8c1c27662">client_address</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#aa02575d0a47a3b36b61bc11fa0167ef7">auth_basic_user</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a1425de5ab040879c2325ec8b6cab9606">auth_basic_password</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a> *      <a class="code" href="struct__u__request.html#aec17dfa65039c0f41d985c3913894a70">map_url</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a> *      <a class="code" href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">map_header</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a> *      <a class="code" href="struct__u__request.html#a3cc4a0f24dfb01ac4eebadffd4754178">map_cookie</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a> *      <a class="code" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">map_post_body</a>;</div>
<div class="line">  <span class="keywordtype">void</span> *               <a class="code" href="struct__u__request.html#a3475938cb332310fef95276c344c2ada">binary_body</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span>               <a class="code" href="struct__u__request.html#a434b1e4238cbe6c1e76913dc3656e86c">binary_body_length</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         <a class="code" href="struct__u__request.html#acaa4ca07d21f689dc4325f0cf72debcd">callback_position</a>;</div>
<div class="line"><span class="preprocessor">#ifndef U_DISABLE_GNUTLS</span></div>
<div class="line">  gnutls_x509_crt_t    <a class="code" href="struct__u__request.html#a39495a9dd4e1d56d4162b628aaba4f31">client_cert</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#af09036a171f2becacb49a42411511832">client_cert_file</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a977318577956a026bbca0cd76daff1ea">client_key_file</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *               <a class="code" href="struct__u__request.html#a2570aaadc5eec23ddbf30900d799f3c1">client_key_password</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">};</span></div>
<div class="ttc" id="astruct__u__request_html_a075f18af2cb3d2e4db3072793b2f3ae3"><div class="ttname"><a href="struct__u__request.html#a075f18af2cb3d2e4db3072793b2f3ae3">_u_request::timeout</a></div><div class="ttdeci">unsigned long timeout</div><div class="ttdef"><b>Definition:</b> ulfius.h:248</div></div>
<div class="ttc" id="astruct__u__request_html_a0ac04ec6f545468e7c1e47c89a50a677"><div class="ttname"><a href="struct__u__request.html#a0ac04ec6f545468e7c1e47c89a50a677">_u_request::check_server_certificate_flag</a></div><div class="ttdeci">int check_server_certificate_flag</div><div class="ttdef"><b>Definition:</b> ulfius.h:243</div></div>
<div class="ttc" id="astruct__u__request_html_a0d5efa3b4e143e8b624ccee8db515e76"><div class="ttname"><a href="struct__u__request.html#a0d5efa3b4e143e8b624ccee8db515e76">_u_request::follow_redirect</a></div><div class="ttdeci">int follow_redirect</div><div class="ttdef"><b>Definition:</b> ulfius.h:246</div></div>
<div class="ttc" id="astruct__u__request_html_a1425de5ab040879c2325ec8b6cab9606"><div class="ttname"><a href="struct__u__request.html#a1425de5ab040879c2325ec8b6cab9606">_u_request::auth_basic_password</a></div><div class="ttdeci">char * auth_basic_password</div><div class="ttdef"><b>Definition:</b> ulfius.h:251</div></div>
<div class="ttc" id="astruct__u__request_html_a1514b0e328911bc647ff5f69cc8f36f8"><div class="ttname"><a href="struct__u__request.html#a1514b0e328911bc647ff5f69cc8f36f8">_u_request::http_protocol</a></div><div class="ttdeci">char * http_protocol</div><div class="ttdef"><b>Definition:</b> ulfius.h:234</div></div>
<div class="ttc" id="astruct__u__request_html_a219f5178b5fd55d040638298418de0f3"><div class="ttname"><a href="struct__u__request.html#a219f5178b5fd55d040638298418de0f3">_u_request::check_proxy_certificate_flag</a></div><div class="ttdeci">int check_proxy_certificate_flag</div><div class="ttdef"><b>Definition:</b> ulfius.h:245</div></div>
<div class="ttc" id="astruct__u__request_html_a2570aaadc5eec23ddbf30900d799f3c1"><div class="ttname"><a href="struct__u__request.html#a2570aaadc5eec23ddbf30900d799f3c1">_u_request::client_key_password</a></div><div class="ttdeci">char * client_key_password</div><div class="ttdef"><b>Definition:</b> ulfius.h:263</div></div>
<div class="ttc" id="astruct__u__request_html_a3475938cb332310fef95276c344c2ada"><div class="ttname"><a href="struct__u__request.html#a3475938cb332310fef95276c344c2ada">_u_request::binary_body</a></div><div class="ttdeci">void * binary_body</div><div class="ttdef"><b>Definition:</b> ulfius.h:256</div></div>
<div class="ttc" id="astruct__u__request_html_a39495a9dd4e1d56d4162b628aaba4f31"><div class="ttname"><a href="struct__u__request.html#a39495a9dd4e1d56d4162b628aaba4f31">_u_request::client_cert</a></div><div class="ttdeci">gnutls_x509_crt_t client_cert</div><div class="ttdef"><b>Definition:</b> ulfius.h:260</div></div>
<div class="ttc" id="astruct__u__request_html_a3cc4a0f24dfb01ac4eebadffd4754178"><div class="ttname"><a href="struct__u__request.html#a3cc4a0f24dfb01ac4eebadffd4754178">_u_request::map_cookie</a></div><div class="ttdeci">struct _u_map * map_cookie</div><div class="ttdef"><b>Definition:</b> ulfius.h:254</div></div>
<div class="ttc" id="astruct__u__request_html_a434b1e4238cbe6c1e76913dc3656e86c"><div class="ttname"><a href="struct__u__request.html#a434b1e4238cbe6c1e76913dc3656e86c">_u_request::binary_body_length</a></div><div class="ttdeci">size_t binary_body_length</div><div class="ttdef"><b>Definition:</b> ulfius.h:257</div></div>
<div class="ttc" id="astruct__u__request_html_a5af37fbc96a4e8e285dddff71a0af824"><div class="ttname"><a href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">_u_request::map_header</a></div><div class="ttdeci">struct _u_map * map_header</div><div class="ttdef"><b>Definition:</b> ulfius.h:253</div></div>
<div class="ttc" id="astruct__u__request_html_a62427dbc71d4e59b50bae06a0b93993c"><div class="ttname"><a href="struct__u__request.html#a62427dbc71d4e59b50bae06a0b93993c">_u_request::check_server_certificate</a></div><div class="ttdeci">int check_server_certificate</div><div class="ttdef"><b>Definition:</b> ulfius.h:242</div></div>
<div class="ttc" id="astruct__u__request_html_a6a8d20bca41838f50ad359c8c1c27662"><div class="ttname"><a href="struct__u__request.html#a6a8d20bca41838f50ad359c8c1c27662">_u_request::client_address</a></div><div class="ttdeci">struct sockaddr * client_address</div><div class="ttdef"><b>Definition:</b> ulfius.h:249</div></div>
<div class="ttc" id="astruct__u__request_html_a7161541bf0dab12e76b6651b8184251e"><div class="ttname"><a href="struct__u__request.html#a7161541bf0dab12e76b6651b8184251e">_u_request::ca_path</a></div><div class="ttdeci">char * ca_path</div><div class="ttdef"><b>Definition:</b> ulfius.h:247</div></div>
<div class="ttc" id="astruct__u__request_html_a78094a8748f9bd47411e48a1839bfc24"><div class="ttname"><a href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">_u_request::map_post_body</a></div><div class="ttdeci">struct _u_map * map_post_body</div><div class="ttdef"><b>Definition:</b> ulfius.h:255</div></div>
<div class="ttc" id="astruct__u__request_html_a8daf471704c90509e9b673288b9d307e"><div class="ttname"><a href="struct__u__request.html#a8daf471704c90509e9b673288b9d307e">_u_request::check_proxy_certificate</a></div><div class="ttdeci">int check_proxy_certificate</div><div class="ttdef"><b>Definition:</b> ulfius.h:244</div></div>
<div class="ttc" id="astruct__u__request_html_a977318577956a026bbca0cd76daff1ea"><div class="ttname"><a href="struct__u__request.html#a977318577956a026bbca0cd76daff1ea">_u_request::client_key_file</a></div><div class="ttdeci">char * client_key_file</div><div class="ttdef"><b>Definition:</b> ulfius.h:262</div></div>
<div class="ttc" id="astruct__u__request_html_a9c8154bb217d7792f8bb08c8f009c2bb"><div class="ttname"><a href="struct__u__request.html#a9c8154bb217d7792f8bb08c8f009c2bb">_u_request::url_path</a></div><div class="ttdeci">char * url_path</div><div class="ttdef"><b>Definition:</b> ulfius.h:237</div></div>
<div class="ttc" id="astruct__u__request_html_aa02575d0a47a3b36b61bc11fa0167ef7"><div class="ttname"><a href="struct__u__request.html#aa02575d0a47a3b36b61bc11fa0167ef7">_u_request::auth_basic_user</a></div><div class="ttdeci">char * auth_basic_user</div><div class="ttdef"><b>Definition:</b> ulfius.h:250</div></div>
<div class="ttc" id="astruct__u__request_html_ab4cc108c47b22d03d7cc5338e3439f7d"><div class="ttname"><a href="struct__u__request.html#ab4cc108c47b22d03d7cc5338e3439f7d">_u_request::http_verb</a></div><div class="ttdeci">char * http_verb</div><div class="ttdef"><b>Definition:</b> ulfius.h:235</div></div>
<div class="ttc" id="astruct__u__request_html_acaa4ca07d21f689dc4325f0cf72debcd"><div class="ttname"><a href="struct__u__request.html#acaa4ca07d21f689dc4325f0cf72debcd">_u_request::callback_position</a></div><div class="ttdeci">unsigned int callback_position</div><div class="ttdef"><b>Definition:</b> ulfius.h:258</div></div>
<div class="ttc" id="astruct__u__request_html_ad6021c5be3e6f214d0eca9134a58e9b1"><div class="ttname"><a href="struct__u__request.html#ad6021c5be3e6f214d0eca9134a58e9b1">_u_request::proxy</a></div><div class="ttdeci">char * proxy</div><div class="ttdef"><b>Definition:</b> ulfius.h:238</div></div>
<div class="ttc" id="astruct__u__request_html_ae1b2bb23752f9f54829845b38f7cdeb0"><div class="ttname"><a href="struct__u__request.html#ae1b2bb23752f9f54829845b38f7cdeb0">_u_request::http_url</a></div><div class="ttdeci">char * http_url</div><div class="ttdef"><b>Definition:</b> ulfius.h:236</div></div>
<div class="ttc" id="astruct__u__request_html_aec17dfa65039c0f41d985c3913894a70"><div class="ttname"><a href="struct__u__request.html#aec17dfa65039c0f41d985c3913894a70">_u_request::map_url</a></div><div class="ttdeci">struct _u_map * map_url</div><div class="ttdef"><b>Definition:</b> ulfius.h:252</div></div>
<div class="ttc" id="astruct__u__request_html_af09036a171f2becacb49a42411511832"><div class="ttname"><a href="struct__u__request.html#af09036a171f2becacb49a42411511832">_u_request::client_cert_file</a></div><div class="ttdeci">char * client_cert_file</div><div class="ttdef"><b>Definition:</b> ulfius.h:261</div></div>
</div><!-- fragment --><p>Functions dedicated to handle the request:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#ga9da30fb0692ae2adfa0bdbebae85e3fd">ulfius_set_string_body_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * request, <span class="keyword">const</span> <span class="keywordtype">char</span> * string_body);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#gac4be8d282071a9415ff1ea88655f7a12">ulfius_set_binary_body_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * request, <span class="keyword">const</span> <span class="keywordtype">char</span> * binary_body, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#ga546f0e75779e04277ea5e1c3b4c6f4c2">ulfius_set_empty_body_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="ttc" id="agroup__parameters_html_ga546f0e75779e04277ea5e1c3b4c6f4c2"><div class="ttname"><a href="group__parameters.html#ga546f0e75779e04277ea5e1c3b4c6f4c2">ulfius_set_empty_body_request</a></div><div class="ttdeci">int ulfius_set_empty_body_request(struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:751</div></div>
<div class="ttc" id="agroup__parameters_html_ga9da30fb0692ae2adfa0bdbebae85e3fd"><div class="ttname"><a href="group__parameters.html#ga9da30fb0692ae2adfa0bdbebae85e3fd">ulfius_set_string_body_request</a></div><div class="ttdeci">int ulfius_set_string_body_request(struct _u_request *request, const char *string_body)</div><div class="ttdef"><b>Definition:</b> u_request.c:704</div></div>
<div class="ttc" id="agroup__parameters_html_gac4be8d282071a9415ff1ea88655f7a12"><div class="ttname"><a href="group__parameters.html#gac4be8d282071a9415ff1ea88655f7a12">ulfius_set_binary_body_request</a></div><div class="ttdeci">int ulfius_set_binary_body_request(struct _u_request *request, const char *binary_body, const size_t length)</div><div class="ttdef"><b>Definition:</b> u_request.c:726</div></div>
</div><!-- fragment --><h2>ulfius_set_request_properties <a class="anchor" id="ulfius_set_request_properties"></a></h2>
<p>The function <code>ulfius_set_request_properties</code> allows to put a variable set of request properties in a single-line. The parameter list MUST end with the option <code>U_OPT_NONE</code></p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * ulfius_set_request_properties</div>
<div class="line"> * Set a list of properties to a request</div>
<div class="line"> * return U_OK on success</div>
<div class="line"> */</div>
<div class="line">int ulfius_set_request_properties(struct _u_request * request, ...);</div>
</div><!-- fragment --><p>Options available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_NONE   </td><td class="markdownTableBodyNone">Empty option to complete a ulfius_set_request_properties or ulfius_set_request_properties    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_HTTP_VERB   </td><td class="markdownTableBodyNone">http method (GET, POST, PUT, DELETE, etc.), expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_HTTP_URL   </td><td class="markdownTableBodyNone">full URL used to call this callback function or full URL to call when used in a ulfius_send_http_request, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_HTTP_URL_APPEND   </td><td class="markdownTableBodyNone">append char * value to the current url, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_HTTP_PROXY   </td><td class="markdownTableBodyNone">proxy address to use for outgoing connections, used by ulfius_send_http_request, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_NETWORK_TYPE   </td><td class="markdownTableBodyNone">Force connect to IPv4, IPv6 addresses or both, values available are U_USE_ALL, U_USE_IPV4 or U_USE_IPV6, expected option value type: unsigned short    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_CHECK_SERVER_CERTIFICATE   </td><td class="markdownTableBodyNone">check server certificate and hostname, default true, used by ulfius_send_http_request, expected option value type: int    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_CHECK_SERVER_CERTIFICATE_FLAG   </td><td class="markdownTableBodyNone">check certificate peer and or server hostname if check_server_certificate is enabled, values available are U_SSL_VERIFY_PEER, U_SSL_VERIFY_HOSTNAME or both, default value is both (U_SSL_VERIFY_PEER|U_SSL_VERIFY_HOSTNAME), used by ulfius_send_http_request, expected option value type: int    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_CHECK_PROXY_CERTIFICATE   </td><td class="markdownTableBodyNone">check proxy certificate and hostname, default true, used by ulfius_send_http_request, requires libcurl &gt;= 7.52, expected option value type: int    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_CHECK_PROXY_CERTIFICATE_FLAG   </td><td class="markdownTableBodyNone">check certificate peer and or proxy hostname if check_proxy_certificate is enabled, values available are U_SSL_VERIFY_PEER, U_SSL_VERIFY_HOSTNAME or both, default value is both (U_SSL_VERIFY_PEER|U_SSL_VERIFY_HOSTNAME), used by ulfius_send_http_request, requires libcurl &gt;= 7.52, expected option value type: int    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_FOLLOW_REDIRECT   </td><td class="markdownTableBodyNone">follow URL redirections, used by ulfius_send_http_request, expected option value type: int    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_CA_PATH   </td><td class="markdownTableBodyNone">specify a path to CA certificates instead of system path, used by ulfius_send_http_request, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_TIMEOUT   </td><td class="markdownTableBodyNone">connection timeout used by ulfius_send_http_request, default is 0 <em>or</em> Timeout in seconds to close the connection because of inactivity between the client and the server, expected option value type: unsigned long    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_AUTH_BASIC_USER   </td><td class="markdownTableBodyNone">basic authentication username, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_AUTH_BASIC_PASSWORD   </td><td class="markdownTableBodyNone">basic authentication password, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_URL_PARAMETER   </td><td class="markdownTableBodyNone">Add to the map containing the URL variables, both from the route and the ?key=value variables, expected option value type: const char *, const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_HEADER_PARAMETER   </td><td class="markdownTableBodyNone">Add to the map containing the header variables, expected option value type: const char *, const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_COOKIE_PARAMETER   </td><td class="markdownTableBodyNone">Add to the map containing the cookie variables, expected option value type: const char *, const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_POST_BODY_PARAMETER   </td><td class="markdownTableBodyNone">Add to the map containing the post body variables (if available), expected option value type: const char *, const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_URL_PARAMETER_REMOVE   </td><td class="markdownTableBodyNone">Remove from the map containing the URL variables, both from the route and the ?key=value variables, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_HEADER_PARAMETER_REMOVE   </td><td class="markdownTableBodyNone">Remove from map containing the header variables, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_COOKIE_PARAMETER_REMOVE   </td><td class="markdownTableBodyNone">Remove from map containing the cookie variables, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_POST_BODY_PARAMETER_REMOVE   </td><td class="markdownTableBodyNone">Remove from map containing the post body variables (if available), expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_BINARY_BODY   </td><td class="markdownTableBodyNone">Set a raw body to the request or the response, expected option value type: const char *, size_t    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_STRING_BODY   </td><td class="markdownTableBodyNone">Set a char * body to the request or the response, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_JSON_BODY   </td><td class="markdownTableBodyNone">Set a stringified json_t * body to the request or the response, expected option value type: json_t *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_CLIENT_CERT_FILE   </td><td class="markdownTableBodyNone">path to client certificate file for sending http requests with certificate authentication, available only if GnuTLS support is enabled, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_CLIENT_KEY_FILE   </td><td class="markdownTableBodyNone">path to client key file for sending http requests with certificate authentication, available only if GnuTLS support is enabled, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_CLIENT_KEY_PASSWORD   </td><td class="markdownTableBodyNone">password to unlock client key file, available only if GnuTLS support is enabled, expected option value type: const char *   </td></tr>
</table>
<p>Example:</p>
<div class="fragment"><div class="line"><a class="code" href="group__request__response__cookie.html#gac38fe5fb463e6c075548f0a1a4465334">ulfius_set_request_properties</a>(&amp;req, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aa0b3279e86cef2b42827dbf3dfbbb8ae">U_OPT_HTTP_VERB</a>, <span class="stringliteral">&quot;POST&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141a69af7b99f09b0d59600ea60f345be0bb">U_OPT_HTTP_URL</a>, <span class="stringliteral">&quot;https://www.example.com/&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aba9ec7d75505a620a69001bbadb2dad6">U_OPT_CHECK_SERVER_CERTIFICATE</a>, 0, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141ad3f4d37bd5ee68a9ecc955659462bf6c">U_OPT_STRING_BODY</a>, <span class="stringliteral">&quot;Hello World!&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141adb09f61d0e8c412867e8ea0340639050">U_OPT_HEADER_PARAMETER</a>, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;PlainText&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aa2c7fd1fc937614eb0f50513b0bf7801">U_OPT_NONE</a>);</div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141a69af7b99f09b0d59600ea60f345be0bb"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141a69af7b99f09b0d59600ea60f345be0bb">U_OPT_HTTP_URL</a></div><div class="ttdeci">@ U_OPT_HTTP_URL</div><div class="ttdoc">full url used to call this callback function or full url to call when used in a ulfius_send_http_requ...</div><div class="ttdef"><b>Definition:</b> ulfius.h:148</div></div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141aa0b3279e86cef2b42827dbf3dfbbb8ae"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aa0b3279e86cef2b42827dbf3dfbbb8ae">U_OPT_HTTP_VERB</a></div><div class="ttdeci">@ U_OPT_HTTP_VERB</div><div class="ttdoc">http method (GET, POST, PUT, DELETE, etc.), expected option value type: const char *</div><div class="ttdef"><b>Definition:</b> ulfius.h:147</div></div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141aa2c7fd1fc937614eb0f50513b0bf7801"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aa2c7fd1fc937614eb0f50513b0bf7801">U_OPT_NONE</a></div><div class="ttdeci">@ U_OPT_NONE</div><div class="ttdoc">Empty option to complete a ulfius_set_request_properties or ulfius_set_request_properties.</div><div class="ttdef"><b>Definition:</b> ulfius.h:146</div></div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141aba9ec7d75505a620a69001bbadb2dad6"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aba9ec7d75505a620a69001bbadb2dad6">U_OPT_CHECK_SERVER_CERTIFICATE</a></div><div class="ttdeci">@ U_OPT_CHECK_SERVER_CERTIFICATE</div><div class="ttdoc">check server certificate and hostname, default true, used by ulfius_send_http_request,...</div><div class="ttdef"><b>Definition:</b> ulfius.h:153</div></div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141ad3f4d37bd5ee68a9ecc955659462bf6c"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141ad3f4d37bd5ee68a9ecc955659462bf6c">U_OPT_STRING_BODY</a></div><div class="ttdeci">@ U_OPT_STRING_BODY</div><div class="ttdoc">Set a char * body to the request or the reponse, expected option value type: const char *.</div><div class="ttdef"><b>Definition:</b> ulfius.h:172</div></div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141adb09f61d0e8c412867e8ea0340639050"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141adb09f61d0e8c412867e8ea0340639050">U_OPT_HEADER_PARAMETER</a></div><div class="ttdeci">@ U_OPT_HEADER_PARAMETER</div><div class="ttdoc">Add to the map containing the header variables, expected option value type: const char *,...</div><div class="ttdef"><b>Definition:</b> ulfius.h:164</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gac38fe5fb463e6c075548f0a1a4465334"><div class="ttname"><a href="group__request__response__cookie.html#gac38fe5fb463e6c075548f0a1a4465334">ulfius_set_request_properties</a></div><div class="ttdeci">int ulfius_set_request_properties(struct _u_request *request,...)</div><div class="ttdef"><b>Definition:</b> u_request.c:494</div></div>
</div><!-- fragment --><h2>Response structure <a class="anchor" id="response-structure"></a></h2>
<p>The response variable is defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__response.html">_u_response</a> {</div>
<div class="line">  <span class="keywordtype">long</span>               <a class="code" href="struct__u__response.html#a70d5fda4a8043f3ac6d2c30ffa106a38">status</a>;</div>
<div class="line">  <span class="keywordtype">char</span>             * <a class="code" href="struct__u__response.html#a01860db0111eb7153cc6b28d39ef6847">protocol</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a>    * <a class="code" href="struct__u__response.html#a5fcfc5f8dde02ed674b81b98811ee076">map_header</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="struct__u__response.html#a7220facebbadbaa05d7ea4834c41aaed">nb_cookies</a>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__cookie.html">_u_cookie</a> * <a class="code" href="struct__u__response.html#aa2e653bbbf4d63e06c92c834b79b584a">map_cookie</a>;</div>
<div class="line">  <span class="keywordtype">char</span>             * <a class="code" href="struct__u__response.html#ad6ccb299feb4769b5590b8084f96a44c">auth_realm</a>;</div>
<div class="line">  <span class="keywordtype">void</span>             * <a class="code" href="struct__u__response.html#adfa9627eeb9a764eb8db6c473952625e">binary_body</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span>             <a class="code" href="struct__u__response.html#a5dca74f1ac5add8cdc4770805d07b278">binary_body_length</a>;</div>
<div class="line">  ssize_t         (* <a class="code" href="struct__u__response.html#a470c3c4b25c0f773e3c879f1ad48f131">stream_callback</a>) (<span class="keywordtype">void</span> * <a class="code" href="struct__u__response.html#a127aa6de650737fe956ca2689401931f">stream_user_data</a>, uint64_t offset, <span class="keywordtype">char</span> * out_buf, <span class="keywordtype">size_t</span> max);</div>
<div class="line">  void            (* <a class="code" href="struct__u__response.html#ad7267d722f32b17e00e20b2c46a2f2db">stream_callback_free</a>) (<span class="keywordtype">void</span> * <a class="code" href="struct__u__response.html#a127aa6de650737fe956ca2689401931f">stream_user_data</a>);</div>
<div class="line">  uint64_t           <a class="code" href="struct__u__response.html#a566b92ee95d13acb81770e7d2aea158c">stream_size</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span>             <a class="code" href="struct__u__response.html#a054fddb0753c0ffecbe8c74eb02de118">stream_block_size</a>;</div>
<div class="line">  <span class="keywordtype">void</span>             * <a class="code" href="struct__u__response.html#a127aa6de650737fe956ca2689401931f">stream_user_data</a>;</div>
<div class="line">  <span class="keywordtype">void</span>             * <a class="code" href="struct__u__response.html#a51ddc9bddf73a26b43c414e8be47194d">websocket_handle</a>;</div>
<div class="line">  <span class="keywordtype">void</span> *             <a class="code" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">shared_data</a>;</div>
<div class="line">  void            (* <a class="code" href="struct__u__response.html#adc9542bfe43466a49807d7c9e8411b07">free_shared_data</a>)(<span class="keywordtype">void</span> * <a class="code" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">shared_data</a>);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="struct__u__response.html#a82a9c5cb89cf1ea8e7226111a5f26dd3">timeout</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__u__cookie_html"><div class="ttname"><a href="struct__u__cookie.html">_u_cookie</a></div><div class="ttdef"><b>Definition:</b> ulfius.h:215</div></div>
<div class="ttc" id="astruct__u__response_html_a01860db0111eb7153cc6b28d39ef6847"><div class="ttname"><a href="struct__u__response.html#a01860db0111eb7153cc6b28d39ef6847">_u_response::protocol</a></div><div class="ttdeci">char * protocol</div><div class="ttdef"><b>Definition:</b> ulfius.h:275</div></div>
<div class="ttc" id="astruct__u__response_html_a054fddb0753c0ffecbe8c74eb02de118"><div class="ttname"><a href="struct__u__response.html#a054fddb0753c0ffecbe8c74eb02de118">_u_response::stream_block_size</a></div><div class="ttdeci">size_t stream_block_size</div><div class="ttdef"><b>Definition:</b> ulfius.h:285</div></div>
<div class="ttc" id="astruct__u__response_html_a127aa6de650737fe956ca2689401931f"><div class="ttname"><a href="struct__u__response.html#a127aa6de650737fe956ca2689401931f">_u_response::stream_user_data</a></div><div class="ttdeci">void * stream_user_data</div><div class="ttdef"><b>Definition:</b> ulfius.h:286</div></div>
<div class="ttc" id="astruct__u__response_html_a470c3c4b25c0f773e3c879f1ad48f131"><div class="ttname"><a href="struct__u__response.html#a470c3c4b25c0f773e3c879f1ad48f131">_u_response::stream_callback</a></div><div class="ttdeci">ssize_t(* stream_callback)(void *stream_user_data, uint64_t offset, char *out_buf, size_t max)</div><div class="ttdef"><b>Definition:</b> ulfius.h:282</div></div>
<div class="ttc" id="astruct__u__response_html_a51ddc9bddf73a26b43c414e8be47194d"><div class="ttname"><a href="struct__u__response.html#a51ddc9bddf73a26b43c414e8be47194d">_u_response::websocket_handle</a></div><div class="ttdeci">void * websocket_handle</div><div class="ttdef"><b>Definition:</b> ulfius.h:287</div></div>
<div class="ttc" id="astruct__u__response_html_a566b92ee95d13acb81770e7d2aea158c"><div class="ttname"><a href="struct__u__response.html#a566b92ee95d13acb81770e7d2aea158c">_u_response::stream_size</a></div><div class="ttdeci">uint64_t stream_size</div><div class="ttdef"><b>Definition:</b> ulfius.h:284</div></div>
<div class="ttc" id="astruct__u__response_html_a5dca74f1ac5add8cdc4770805d07b278"><div class="ttname"><a href="struct__u__response.html#a5dca74f1ac5add8cdc4770805d07b278">_u_response::binary_body_length</a></div><div class="ttdeci">size_t binary_body_length</div><div class="ttdef"><b>Definition:</b> ulfius.h:281</div></div>
<div class="ttc" id="astruct__u__response_html_a5fcfc5f8dde02ed674b81b98811ee076"><div class="ttname"><a href="struct__u__response.html#a5fcfc5f8dde02ed674b81b98811ee076">_u_response::map_header</a></div><div class="ttdeci">struct _u_map * map_header</div><div class="ttdef"><b>Definition:</b> ulfius.h:276</div></div>
<div class="ttc" id="astruct__u__response_html_a70d5fda4a8043f3ac6d2c30ffa106a38"><div class="ttname"><a href="struct__u__response.html#a70d5fda4a8043f3ac6d2c30ffa106a38">_u_response::status</a></div><div class="ttdeci">long status</div><div class="ttdef"><b>Definition:</b> ulfius.h:274</div></div>
<div class="ttc" id="astruct__u__response_html_a7220facebbadbaa05d7ea4834c41aaed"><div class="ttname"><a href="struct__u__response.html#a7220facebbadbaa05d7ea4834c41aaed">_u_response::nb_cookies</a></div><div class="ttdeci">unsigned int nb_cookies</div><div class="ttdef"><b>Definition:</b> ulfius.h:277</div></div>
<div class="ttc" id="astruct__u__response_html_a82a9c5cb89cf1ea8e7226111a5f26dd3"><div class="ttname"><a href="struct__u__response.html#a82a9c5cb89cf1ea8e7226111a5f26dd3">_u_response::timeout</a></div><div class="ttdeci">unsigned int timeout</div><div class="ttdef"><b>Definition:</b> ulfius.h:290</div></div>
<div class="ttc" id="astruct__u__response_html_aa2e653bbbf4d63e06c92c834b79b584a"><div class="ttname"><a href="struct__u__response.html#aa2e653bbbf4d63e06c92c834b79b584a">_u_response::map_cookie</a></div><div class="ttdeci">struct _u_cookie * map_cookie</div><div class="ttdef"><b>Definition:</b> ulfius.h:278</div></div>
<div class="ttc" id="astruct__u__response_html_ad6ccb299feb4769b5590b8084f96a44c"><div class="ttname"><a href="struct__u__response.html#ad6ccb299feb4769b5590b8084f96a44c">_u_response::auth_realm</a></div><div class="ttdeci">char * auth_realm</div><div class="ttdef"><b>Definition:</b> ulfius.h:279</div></div>
<div class="ttc" id="astruct__u__response_html_ad7267d722f32b17e00e20b2c46a2f2db"><div class="ttname"><a href="struct__u__response.html#ad7267d722f32b17e00e20b2c46a2f2db">_u_response::stream_callback_free</a></div><div class="ttdeci">void(* stream_callback_free)(void *stream_user_data)</div><div class="ttdef"><b>Definition:</b> ulfius.h:283</div></div>
<div class="ttc" id="astruct__u__response_html_adc9542bfe43466a49807d7c9e8411b07"><div class="ttname"><a href="struct__u__response.html#adc9542bfe43466a49807d7c9e8411b07">_u_response::free_shared_data</a></div><div class="ttdeci">void(* free_shared_data)(void *shared_data)</div><div class="ttdef"><b>Definition:</b> ulfius.h:289</div></div>
<div class="ttc" id="astruct__u__response_html_adfa9627eeb9a764eb8db6c473952625e"><div class="ttname"><a href="struct__u__response.html#adfa9627eeb9a764eb8db6c473952625e">_u_response::binary_body</a></div><div class="ttdeci">void * binary_body</div><div class="ttdef"><b>Definition:</b> ulfius.h:280</div></div>
<div class="ttc" id="astruct__u__response_html_af8da57093cc1478ff2e92834b7cdd608"><div class="ttname"><a href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response::shared_data</a></div><div class="ttdeci">void * shared_data</div><div class="ttdef"><b>Definition:</b> ulfius.h:288</div></div>
</div><!-- fragment --><p>In the response variable set by the framework to the callback function, the structure is initialized with no data.</p>
<p>The user can set the <code>binary_body</code> before the return statement, or no response body at all if no need. If a <code>binary_body</code> is set, its size must be set to <code>binary_body_length</code>. <code>binary_body</code> is freed by the framework when the response has been sent to the client, so you must use dynamically allocated values. If no status is set, status 200 will be sent to the client.</p>
<p>Some functions are dedicated to handle the response:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#ga28ca246dafab8c9436409e40ea295cdd">ulfius_add_header_to_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#a2938ff6ca9b57847bd0e139bf81d7065">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#ae1bb2712a3ffb9c30d5ca4cd8b323341">value</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#ga71d2fe9c1f110be0dfa07c5ba41680a6">ulfius_set_string_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> * body);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ulfius_set_binary_response(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> * body, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#gae84451bdf7856760aaf7b096690f5f3f">ulfius_set_empty_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__stream.html#gaf8116c28aa07ef66563a1979eb7b34e4">ulfius_set_stream_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status,</div>
<div class="line">                                ssize_t (* stream_callback) (<span class="keywordtype">void</span> * stream_user_data, uint64_t offset, <span class="keywordtype">char</span> * out_buf, <span class="keywordtype">size_t</span> max);</div>
<div class="line">                                void (* stream_callback_free) (<span class="keywordtype">void</span> * stream_user_data),</div>
<div class="line">                                uint64_t stream_size,</div>
<div class="line">                                <span class="keywordtype">size_t</span> stream_block_size,</div>
<div class="line">                                <span class="keywordtype">void</span> * stream_user_data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a9cf9d96944f3d4fc3930075011cbb4af">ulfius_set_websocket_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_protocol,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_extensions, </div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_manager_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                        <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                        <span class="keywordtype">void</span> * websocket_manager_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_manager_user_data,</div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_incoming_message_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                                 <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                                 <span class="keyword">const</span> <span class="keyword">struct</span> _websocket_message * message,</div>
<div class="line">                                                                                 <span class="keywordtype">void</span> * websocket_incoming_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_incoming_user_data,</div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_onclose_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                        <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                        <span class="keywordtype">void</span> * websocket_onclose_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_onclose_user_data);</div>
<div class="ttc" id="agroup__parameters_html_ga28ca246dafab8c9436409e40ea295cdd"><div class="ttname"><a href="group__parameters.html#ga28ca246dafab8c9436409e40ea295cdd">ulfius_add_header_to_response</a></div><div class="ttdeci">int ulfius_add_header_to_response(struct _u_response *response, const char *key, const char *value)</div><div class="ttdef"><b>Definition:</b> u_response.c:717</div></div>
<div class="ttc" id="agroup__parameters_html_ga71d2fe9c1f110be0dfa07c5ba41680a6"><div class="ttname"><a href="group__parameters.html#ga71d2fe9c1f110be0dfa07c5ba41680a6">ulfius_set_string_body_response</a></div><div class="ttdeci">int ulfius_set_string_body_response(struct _u_response *response, const unsigned int status, const char *string_body)</div><div class="ttdef"><b>Definition:</b> u_response.c:516</div></div>
<div class="ttc" id="agroup__parameters_html_gae84451bdf7856760aaf7b096690f5f3f"><div class="ttname"><a href="group__parameters.html#gae84451bdf7856760aaf7b096690f5f3f">ulfius_set_empty_body_response</a></div><div class="ttdeci">int ulfius_set_empty_body_response(struct _u_response *response, const unsigned int status)</div><div class="ttdef"><b>Definition:</b> u_response.c:555</div></div>
<div class="ttc" id="agroup__stream_html_gaf8116c28aa07ef66563a1979eb7b34e4"><div class="ttname"><a href="group__stream.html#gaf8116c28aa07ef66563a1979eb7b34e4">ulfius_set_stream_response</a></div><div class="ttdeci">int ulfius_set_stream_response(struct _u_response *response, const unsigned int status, ssize_t(*stream_callback)(void *stream_user_data, uint64_t offset, char *out_buf, size_t max), void(*stream_callback_free)(void *stream_user_data), uint64_t stream_size, size_t stream_block_size, void *stream_user_data)</div><div class="ttdef"><b>Definition:</b> u_response.c:569</div></div>
<div class="ttc" id="astruct__u__cookie_html_a2938ff6ca9b57847bd0e139bf81d7065"><div class="ttname"><a href="struct__u__cookie.html#a2938ff6ca9b57847bd0e139bf81d7065">_u_cookie::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> ulfius.h:216</div></div>
<div class="ttc" id="astruct__u__cookie_html_ae1bb2712a3ffb9c30d5ca4cd8b323341"><div class="ttname"><a href="struct__u__cookie.html#ae1bb2712a3ffb9c30d5ca4cd8b323341">_u_cookie::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> ulfius.h:217</div></div>
<div class="ttc" id="au__websocket_8c_html_a9cf9d96944f3d4fc3930075011cbb4af"><div class="ttname"><a href="u__websocket_8c.html#a9cf9d96944f3d4fc3930075011cbb4af">ulfius_set_websocket_response</a></div><div class="ttdeci">int ulfius_set_websocket_response(struct _u_response *response, const char *websocket_protocol, const char *websocket_extensions, void(*websocket_manager_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, void *websocket_manager_user_data), void *websocket_manager_user_data, void(*websocket_incoming_message_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, const struct _websocket_message *message, void *websocket_incoming_user_data), void *websocket_incoming_user_data, void(*websocket_onclose_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, void *websocket_onclose_user_data), void *websocket_onclose_user_data)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1834</div></div>
</div><!-- fragment --><h2>ulfius_set_response_properties <a class="anchor" id="ulfius_set_response_properties"></a></h2>
<p>The function <code>ulfius_set_response_properties</code> allows to put a variable set of response properties in a single-line. The parameter list MUST end with the option <code>U_OPT_NONE</code></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga63a657888d8b55416683ea114f5ae351">ulfius_set_response_properties</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, ...);</div>
<div class="ttc" id="agroup__request__response__cookie_html_ga63a657888d8b55416683ea114f5ae351"><div class="ttname"><a href="group__request__response__cookie.html#ga63a657888d8b55416683ea114f5ae351">ulfius_set_response_properties</a></div><div class="ttdeci">int ulfius_set_response_properties(struct _u_response *response,...)</div><div class="ttdef"><b>Definition:</b> u_response.c:594</div></div>
</div><!-- fragment --><p>Options available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_NONE   </td><td class="markdownTableBodyNone">Empty option to complete a ulfius_set_request_properties or ulfius_set_request_properties    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_STATUS   </td><td class="markdownTableBodyNone">HTTP response status code (200, 404, 500, etc), expected option value type: long    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_AUTH_REALM   </td><td class="markdownTableBodyNone">realm to send to the client response on authentication failed, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_SHARED_DATA   </td><td class="markdownTableBodyNone">any data shared between callback functions, must be allocated and freed by the callback functions, expected option value type: void *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_TIMEOUT   </td><td class="markdownTableBodyNone">Timeout in seconds to close the connection because of inactivity between the client and the server, expected option value type: long    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_HEADER_PARAMETER   </td><td class="markdownTableBodyNone">Add to the map containing the header variables, expected option value type: const char *, const char *    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_HEADER_PARAMETER_REMOVE   </td><td class="markdownTableBodyNone">Remove from map containing the header variables, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_BINARY_BODY   </td><td class="markdownTableBodyNone">Set a raw body to the request or the response, expected option value type: const char *, size_t    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">U_OPT_STRING_BODY   </td><td class="markdownTableBodyNone">Set a char * body to the request or the response, expected option value type: const char *    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">U_OPT_JSON_BODY   </td><td class="markdownTableBodyNone">Set a stringified json_t * body to the request or the response, expected option value type: json_t *   </td></tr>
</table>
<p>Example:</p>
<div class="fragment"><div class="line"><a class="code" href="group__request__response__cookie.html#ga63a657888d8b55416683ea114f5ae351">ulfius_set_response_properties</a>(&amp;req, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141a0d3cd0c30fb9f3e544cc03fd2c4f5fb8">U_OPT_STATUS</a>, 200, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141ad3f4d37bd5ee68a9ecc955659462bf6c">U_OPT_STRING_BODY</a>, <span class="stringliteral">&quot;Hello World!&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141adb09f61d0e8c412867e8ea0340639050">U_OPT_HEADER_PARAMETER</a>, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;PlainText&quot;</span>, <a class="code" href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141aa2c7fd1fc937614eb0f50513b0bf7801">U_OPT_NONE</a>);</div>
<div class="ttc" id="agroup__const_html_gga3341dd9afe22fdef2806f30227cf3141a0d3cd0c30fb9f3e544cc03fd2c4f5fb8"><div class="ttname"><a href="group__const.html#gga3341dd9afe22fdef2806f30227cf3141a0d3cd0c30fb9f3e544cc03fd2c4f5fb8">U_OPT_STATUS</a></div><div class="ttdeci">@ U_OPT_STATUS</div><div class="ttdoc">HTTP response status code (200, 404, 500, etc), expected option value type: long.</div><div class="ttdef"><b>Definition:</b> ulfius.h:181</div></div>
</div><!-- fragment --><h2>Callback functions return value <a class="anchor" id="callback-functions-return-value"></a></h2>
<p>The callback returned value can have the following values:</p>
<ul>
<li><code>U_CALLBACK_CONTINUE</code>: The framework can transfer the request and the response to the next callback function in priority order if there is one, or complete the transaction and send back the response to the client.</li>
<li><code>U_CALLBACK_IGNORE</code>: The framework can transfer the request and the response to the next callback function in priority order if there is one, or complete the transaction and send back the response to the client, the counter <code>request-&gt;callback_position</code> will not be incremented. If at the end of the callback list <code>request-&gt;callback_position</code> is 0, the default callback (if set) will be called.</li>
<li><code>U_CALLBACK_COMPLETE</code>: The framework must complete the transaction and send the response to the client without calling any further callback function.</li>
<li><code>U_CALLBACK_UNAUTHORIZED</code>: The framework must complete the transaction without calling any further callback function and send an unauthorized response to the client with the status 401, the body specified and the <code>auth_realm</code> value if specified.</li>
<li><code>U_CALLBACK_ERROR</code>: An error occurred during execution, the framework will complete the transaction without calling any further callback function and send an error 500 to the client.</li>
</ul>
<p>Except for the return values <code>U_CALLBACK_UNAUTHORIZED</code> and <code>U_CALLBACK_ERROR</code>, the callback return value isn't useful to specify the response sent back to the client. Use the <code>struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code> variable in your callback function to set all values in the HTTP response.</p>
<h2>Use JSON in request and response body <a class="anchor" id="use-json-in-request-and-response-body"></a></h2>
<p>In Ulfius 2.0, hard dependency with <code>libjansson</code> has been removed, the Jansson library is now optional but enabled by default.</p>
<p>If you want to remove JSON dependency, build Ulfius library using Makefile with the flag <code>JANSSONFLAG=1</code> or CMake with the option <code>-DWITH_WEBSOCKET=off</code>.</p>
<div class="fragment"><div class="line">$ make JANSSONFLAG=1 # Makefile</div>
<div class="line">$ cmake -DWITH_WEBSOCKET=off # CMake</div>
</div><!-- fragment --><p>if JSON is enabled, the following functions are available in Ulfius:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__request__response__cookie.html#ga42e4ff79ea7e40eea5d3ce9128abe9c1">ulfius_get_json_body_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, json_error_t * json_error);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gade63875f40cb95ff87cde09221ff6410">ulfius_set_json_body_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, json_t * body);</div>
<div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__request__response__cookie.html#ga41177752a15dc4248707be238c7e98e4">ulfius_get_json_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, json_error_t * json_error);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gab8e28e99208b630ee6327e21da22fc9a">ulfius_set_json_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> json_t * body);</div>
<div class="ttc" id="agroup__request__response__cookie_html_ga41177752a15dc4248707be238c7e98e4"><div class="ttname"><a href="group__request__response__cookie.html#ga41177752a15dc4248707be238c7e98e4">ulfius_get_json_body_response</a></div><div class="ttdeci">json_t * ulfius_get_json_body_response(struct _u_response *response, json_error_t *json_error)</div><div class="ttdef"><b>Definition:</b> u_response.c:709</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga42e4ff79ea7e40eea5d3ce9128abe9c1"><div class="ttname"><a href="group__request__response__cookie.html#ga42e4ff79ea7e40eea5d3ce9128abe9c1">ulfius_get_json_body_request</a></div><div class="ttdeci">json_t * ulfius_get_json_body_request(const struct _u_request *request, json_error_t *json_error)</div><div class="ttdef"><b>Definition:</b> u_request.c:979</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gab8e28e99208b630ee6327e21da22fc9a"><div class="ttname"><a href="group__request__response__cookie.html#gab8e28e99208b630ee6327e21da22fc9a">ulfius_set_json_body_response</a></div><div class="ttdeci">int ulfius_set_json_body_response(struct _u_response *response, const unsigned int status, const json_t *j_body)</div><div class="ttdef"><b>Definition:</b> u_response.c:682</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gade63875f40cb95ff87cde09221ff6410"><div class="ttname"><a href="group__request__response__cookie.html#gade63875f40cb95ff87cde09221ff6410">ulfius_set_json_body_request</a></div><div class="ttdeci">int ulfius_set_json_body_request(struct _u_request *request, json_t *j_body)</div><div class="ttdef"><b>Definition:</b> u_request.c:953</div></div>
</div><!-- fragment --><p>The <code>jansson</code> API documentation is available at the following address: <a href="https://jansson.readthedocs.org/">Jansson documentation</a>.</p>
<p>Note: According to the <a href="https://tools.ietf.org/html/rfc4627#section-6">JSON RFC section 6</a>, the MIME media type for JSON text is <code>application/json</code>. Thus, if there is no HTTP header specifying JSON content-type, the functions <code>ulfius_get_json_body_request</code> and <code>ulfius_get_json_body_response</code> will return NULL.</p>
<h2>Additional functions <a class="anchor" id="additional-functions"></a></h2>
<p>In addition with manipulating the raw parameters of the structures, you can use the <code><a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code> and <code><a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code> structures by using specific functions designed to facilitate their use and memory management:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga2c4c4b41dab8d5b5ad6493a37fd9e69e">ulfius_init_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga6c5d177fee97aed70b1cda7425e85ed5">ulfius_clean_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga5535ff284673b76f17bfc8b103666454">ulfius_clean_request_full</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga2e191d61b05b69030f4d496d15b6088d">ulfius_init_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga5cd00e853403c70d491412ef8061fdaf">ulfius_clean_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gae119edbe504a6d7803acb52cfeda0f80">ulfius_clean_response_full</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga53897c83322dc2b6716551b4a9170517">ulfius_copy_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * dest, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * source);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gaddc5dc462308efa4beac4542c9568bb4">ulfius_clean_cookie</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__cookie.html">_u_cookie</a> * cookie);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#ga0cd968c631646cfcdc241fbef480a70e">ulfius_copy_cookie</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__cookie.html">_u_cookie</a> * dest, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__cookie.html">_u_cookie</a> * source);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__request.html">_u_request</a> * <a class="code" href="group__request__response__cookie.html#ga8e81ee7bd988631b74d630b3dc80dab0">ulfius_duplicate_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__response.html">_u_response</a> * <a class="code" href="group__request__response__cookie.html#gaca7e470bd96c07482ea95a24c6fd1b44">ulfius_duplicate_response</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="ttc" id="agroup__request__response__cookie_html_ga0cd968c631646cfcdc241fbef480a70e"><div class="ttname"><a href="group__request__response__cookie.html#ga0cd968c631646cfcdc241fbef480a70e">ulfius_copy_cookie</a></div><div class="ttdeci">int ulfius_copy_cookie(struct _u_cookie *dest, const struct _u_cookie *source)</div><div class="ttdef"><b>Definition:</b> u_response.c:307</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga2c4c4b41dab8d5b5ad6493a37fd9e69e"><div class="ttname"><a href="group__request__response__cookie.html#ga2c4c4b41dab8d5b5ad6493a37fd9e69e">ulfius_init_request</a></div><div class="ttdeci">int ulfius_init_request(struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:267</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga2e191d61b05b69030f4d496d15b6088d"><div class="ttname"><a href="group__request__response__cookie.html#ga2e191d61b05b69030f4d496d15b6088d">ulfius_init_response</a></div><div class="ttdeci">int ulfius_init_response(struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_response.c:373</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga53897c83322dc2b6716551b4a9170517"><div class="ttname"><a href="group__request__response__cookie.html#ga53897c83322dc2b6716551b4a9170517">ulfius_copy_response</a></div><div class="ttdeci">int ulfius_copy_response(struct _u_response *dest, const struct _u_response *source)</div><div class="ttdef"><b>Definition:</b> u_response.c:426</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga5535ff284673b76f17bfc8b103666454"><div class="ttname"><a href="group__request__response__cookie.html#ga5535ff284673b76f17bfc8b103666454">ulfius_clean_request_full</a></div><div class="ttdeci">int ulfius_clean_request_full(struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:366</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_ga8e81ee7bd988631b74d630b3dc80dab0"><div class="ttname"><a href="group__request__response__cookie.html#ga8e81ee7bd988631b74d630b3dc80dab0">ulfius_duplicate_request</a></div><div class="ttdeci">struct _u_request * ulfius_duplicate_request(const struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:767</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gaca7e470bd96c07482ea95a24c6fd1b44"><div class="ttname"><a href="group__request__response__cookie.html#gaca7e470bd96c07482ea95a24c6fd1b44">ulfius_duplicate_response</a></div><div class="ttdeci">struct _u_response * ulfius_duplicate_response(const struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_response.c:493</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gaddc5dc462308efa4beac4542c9568bb4"><div class="ttname"><a href="group__request__response__cookie.html#gaddc5dc462308efa4beac4542c9568bb4">ulfius_clean_cookie</a></div><div class="ttdeci">int ulfius_clean_cookie(struct _u_cookie *cookie)</div><div class="ttdef"><b>Definition:</b> u_response.c:289</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gae119edbe504a6d7803acb52cfeda0f80"><div class="ttname"><a href="group__request__response__cookie.html#gae119edbe504a6d7803acb52cfeda0f80">ulfius_clean_response_full</a></div><div class="ttdeci">int ulfius_clean_response_full(struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_response.c:364</div></div>
</div><!-- fragment --><h2>Memory management <a class="anchor" id="memory-management-1"></a></h2>
<p>The Ulfius framework will automatically free the variables referenced by the request and responses structures, so you must use dynamically allocated values for the response pointers.</p>
<h2>Character encoding <a class="anchor" id="character-encoding"></a></h2>
<p>You may be careful with characters encoding if you use non UTF8 characters in your application or webservice source code, and especially if you use different encoding in the same application. Ulfius may not work properly.</p>
<h2>Accessing POST parameters <a class="anchor" id="accessing-post-parameters"></a></h2>
<p>In the callback function, you can access the POST parameters in the <code>struct <a class="el" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">_u_request.map_post_body</a></code>. The parameters keys are case-sensitive.</p>
<p>This variable is a <code>struct <a class="el" href="struct__u__map.html">_u_map</a></code>, therefore you can access it using the <a href="#struct-_u_map-api">struct _u_map documentation</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Example of accessing a POST parameter</span></div>
<div class="line"><span class="keywordtype">int</span> callback_test (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;POST parameter id: %s\n&quot;</span>, <a class="code" href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a>(request-&gt;<a class="code" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">map_post_body</a>, <span class="stringliteral">&quot;id&quot;</span>));</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__u__map_html_ga37a1c2e6b3e7213231ad7ca8d797c479"><div class="ttname"><a href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a></div><div class="ttdeci">const char * u_map_get(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:377</div></div>
</div><!-- fragment --><h2>Accessing query string and URL parameters <a class="anchor" id="accessing-query-string-and-url-parameters"></a></h2>
<p>In the callback function, you can access the URL and query parameters in the <code>struct <a class="el" href="struct__u__request.html#aec17dfa65039c0f41d985c3913894a70">_u_request.map_url</a></code>. This variable contains both URL parameters and query string parameters, the parameters keys are case-sensitive. If a parameter appears multiple times in the URL and the query string, the values will be chained in the <code>struct <a class="el" href="struct__u__request.html#aec17dfa65039c0f41d985c3913894a70">_u_request.map_url</a></code>, separated by a comma <code>,</code>.</p>
<p>This variable is a <code>struct <a class="el" href="struct__u__map.html">_u_map</a></code>, therefore you can access it using the <a href="#struct-_u_map-api">struct _u_map documentation</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Example of accessing URL parameters</span></div>
<div class="line"><span class="keywordtype">int</span> callback_test (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;URL parameter id: %s\n&quot;</span>, <a class="code" href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a>(request-&gt;<a class="code" href="struct__u__request.html#aec17dfa65039c0f41d985c3913894a70">map_url</a>, <span class="stringliteral">&quot;id&quot;</span>));</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Accessing header parameters <a class="anchor" id="accessing-header-parameters"></a></h2>
<p>In the callback function, you can access the header parameters in the <code>struct <a class="el" href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">_u_request.map_header</a></code>.</p>
<p>In the callback function, you can access the header parameters in the <code>struct <a class="el" href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">_u_request.map_header</a></code>. The parameters keys are case-sensitive. If a parameter appears multiple times in the header, the values will be chained in the <code>struct <a class="el" href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">_u_request.map_header</a></code>, separated by a comma <code>,</code>.</p>
<p>This variable is a <code>struct <a class="el" href="struct__u__map.html">_u_map</a></code>, therefore you can access it using the <a href="#struct-_u_map-api">struct _u_map documentation</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Example of accessing a POST parameter</span></div>
<div class="line"><span class="keywordtype">int</span> callback_test (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;Heder parameter id: %s\n&quot;</span>, <a class="code" href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a>(request-&gt;<a class="code" href="struct__u__request.html#a5af37fbc96a4e8e285dddff71a0af824">map_header</a>, <span class="stringliteral">&quot;id&quot;</span>));</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Cookie management <a class="anchor" id="cookie-management"></a></h2>
<p>The map_cookie structure will contain a set of key/values for the cookies. The cookie structure is defined as</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__cookie.html">_u_cookie</a> {</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#a2938ff6ca9b57847bd0e139bf81d7065">key</a>;</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#ae1bb2712a3ffb9c30d5ca4cd8b323341">value</a>;</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#a88ce6125c5c18d4b5c35827997544d8d">expires</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   <a class="code" href="struct__u__cookie.html#afafa1547ec8836bffc8fea52af02d84a">max_age</a>;</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#aad1fdc1d8a3a1fc16f691f6b5be93d5c">domain</a>;</div>
<div class="line">  <span class="keywordtype">char</span> * <a class="code" href="struct__u__cookie.html#a517791ad759004dd468ba52846996617">path</a>;</div>
<div class="line">  <span class="keywordtype">int</span>    <a class="code" href="struct__u__cookie.html#ab59e796c328a5b00ead21f093cb5113b">secure</a>;</div>
<div class="line">  <span class="keywordtype">int</span>    <a class="code" href="struct__u__cookie.html#aadb77d885ab0a2f0775be4dcf6f1e56c">http_only</a>;</div>
<div class="line">  <span class="keywordtype">int</span>    <a class="code" href="struct__u__cookie.html#abc07323de398f3344c754788bce03975">same_site</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astruct__u__cookie_html_a517791ad759004dd468ba52846996617"><div class="ttname"><a href="struct__u__cookie.html#a517791ad759004dd468ba52846996617">_u_cookie::path</a></div><div class="ttdeci">char * path</div><div class="ttdef"><b>Definition:</b> ulfius.h:221</div></div>
<div class="ttc" id="astruct__u__cookie_html_a88ce6125c5c18d4b5c35827997544d8d"><div class="ttname"><a href="struct__u__cookie.html#a88ce6125c5c18d4b5c35827997544d8d">_u_cookie::expires</a></div><div class="ttdeci">char * expires</div><div class="ttdef"><b>Definition:</b> ulfius.h:218</div></div>
<div class="ttc" id="astruct__u__cookie_html_aad1fdc1d8a3a1fc16f691f6b5be93d5c"><div class="ttname"><a href="struct__u__cookie.html#aad1fdc1d8a3a1fc16f691f6b5be93d5c">_u_cookie::domain</a></div><div class="ttdeci">char * domain</div><div class="ttdef"><b>Definition:</b> ulfius.h:220</div></div>
<div class="ttc" id="astruct__u__cookie_html_aadb77d885ab0a2f0775be4dcf6f1e56c"><div class="ttname"><a href="struct__u__cookie.html#aadb77d885ab0a2f0775be4dcf6f1e56c">_u_cookie::http_only</a></div><div class="ttdeci">int http_only</div><div class="ttdef"><b>Definition:</b> ulfius.h:223</div></div>
<div class="ttc" id="astruct__u__cookie_html_ab59e796c328a5b00ead21f093cb5113b"><div class="ttname"><a href="struct__u__cookie.html#ab59e796c328a5b00ead21f093cb5113b">_u_cookie::secure</a></div><div class="ttdeci">int secure</div><div class="ttdef"><b>Definition:</b> ulfius.h:222</div></div>
<div class="ttc" id="astruct__u__cookie_html_abc07323de398f3344c754788bce03975"><div class="ttname"><a href="struct__u__cookie.html#abc07323de398f3344c754788bce03975">_u_cookie::same_site</a></div><div class="ttdeci">int same_site</div><div class="ttdef"><b>Definition:</b> ulfius.h:224</div></div>
<div class="ttc" id="astruct__u__cookie_html_afafa1547ec8836bffc8fea52af02d84a"><div class="ttname"><a href="struct__u__cookie.html#afafa1547ec8836bffc8fea52af02d84a">_u_cookie::max_age</a></div><div class="ttdeci">unsigned int max_age</div><div class="ttdef"><b>Definition:</b> ulfius.h:219</div></div>
</div><!-- fragment --><p>You can use the functions <code>ulfius_add_cookie_to_response</code> or <code>ulfius_add_same_site_cookie_to_response</code> in your callback function to facilitate cookies management. These functions are defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__cookie.html#ga10454efe596e0d570ae54bb5bb6cf34e">ulfius_add_cookie_to_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value, <span class="keyword">const</span> <span class="keywordtype">char</span> * expires, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_age, </div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">char</span> * domain, <span class="keyword">const</span> <span class="keywordtype">char</span> * path, <span class="keyword">const</span> <span class="keywordtype">int</span> secure, <span class="keyword">const</span> <span class="keywordtype">int</span> http_only);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__cookie.html#ga682fd6c087b9b5bcff3698c6fe3f7eae">ulfius_add_same_site_cookie_to_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value, <span class="keyword">const</span> <span class="keywordtype">char</span> * expires, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_age,</div>
<div class="line">                                            <span class="keyword">const</span> <span class="keywordtype">char</span> * domain, <span class="keyword">const</span> <span class="keywordtype">char</span> * path, <span class="keyword">const</span> <span class="keywordtype">int</span> secure, <span class="keyword">const</span> <span class="keywordtype">int</span> http_only, <span class="keyword">const</span> <span class="keywordtype">int</span> same_site);</div>
<div class="ttc" id="agroup__cookie_html_ga10454efe596e0d570ae54bb5bb6cf34e"><div class="ttname"><a href="group__cookie.html#ga10454efe596e0d570ae54bb5bb6cf34e">ulfius_add_cookie_to_response</a></div><div class="ttdeci">int ulfius_add_cookie_to_response(struct _u_response *response, const char *key, const char *value, const char *expires, const unsigned int max_age, const char *domain, const char *path, const int secure, const int http_only)</div><div class="ttdef"><b>Definition:</b> u_response.c:206</div></div>
<div class="ttc" id="agroup__cookie_html_ga682fd6c087b9b5bcff3698c6fe3f7eae"><div class="ttname"><a href="group__cookie.html#ga682fd6c087b9b5bcff3698c6fe3f7eae">ulfius_add_same_site_cookie_to_response</a></div><div class="ttdeci">int ulfius_add_same_site_cookie_to_response(struct _u_response *response, const char *key, const char *value, const char *expires, const unsigned int max_age, const char *domain, const char *path, const int secure, const int http_only, const int same_site)</div><div class="ttdef"><b>Definition:</b> u_response.c:211</div></div>
</div><!-- fragment --><p>If you need to remove a cookie on the client, you can send a cookie with the same key but an empty value and a expiration in the past.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Example of a cookie removal, you must change the values domain, path, secure, http_only</span></div>
<div class="line"><span class="comment"> * according to your settings</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span> * expires = <span class="stringliteral">&quot;Sat, 10 Jan 1970 12:00:00 GMT&quot;</span></div>
<div class="line"><a class="code" href="group__cookie.html#ga10454efe596e0d570ae54bb5bb6cf34e">ulfius_add_cookie_to_response</a>(response, <span class="stringliteral">&quot;cookie_key&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, expires, 0, <span class="stringliteral">&quot;your_domain.tld&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, 0, 0);</div>
</div><!-- fragment --><p>Please note that the client (browser, app, etc.) doesn't have to remove the cookies if it doesn't want to.</p>
<h1>File upload <a class="anchor" id="file-upload"></a></h1>
<p>Ulfius allows file upload to the server. Beware that an uploaded file will be stored in the request object in memory, so uploading large files may dramatically slow the application or even crash it, depending on your system. An uploaded file is stored in the <code>request-&gt;map_body</code> structure. You can use <code>u_map_get_length</code> to get the exact length of the file as it may not be a string format.</p>
<p>If you want to limit the size of a post parameter, if you want to limit the file size for example, set the value <code>struct <a class="el" href="struct__u__instance.html#a24a5d7e3bda73eb7f5d5427b8606b12a">_u_instance.max_post_param_size</a></code>. Files or post data exceeding this size will be truncated to the size <code>struct <a class="el" href="struct__u__instance.html#a24a5d7e3bda73eb7f5d5427b8606b12a">_u_instance.max_post_param_size</a></code>. If this parameter is 0, then no limit is set. Default value is 0.</p>
<p>If you want to handle file upload yourself, you can intercept the file upload process with your own callback function. Before running the webservice with <code>ulfius_start_framework</code>, you must call the function <code>ulfius_set_upload_file_callback_function</code> with a pointer to your file upload callback function. By using this method, the specified callback function will be executed as much as needed with a chunk of the file upload each time.</p>
<p>This function <code>ulfius_set_upload_file_callback_function</code> has the following prototype:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__instance.html#gafb2f3a9d7bbfbcf3acc0f9a88ab9507e">ulfius_set_upload_file_callback_function</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__instance.html">_u_instance</a> * u_instance,</div>
<div class="line">                                             <span class="keywordtype">int</span> (* file_upload_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, </div>
<div class="line">                                                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * key, </div>
<div class="line">                                                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * filename, </div>
<div class="line">                                                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * content_type, </div>
<div class="line">                                                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * transfer_encoding, </div>
<div class="line">                                                                           <span class="keyword">const</span> <span class="keywordtype">char</span> * data, </div>
<div class="line">                                                                           uint64_t off, </div>
<div class="line">                                                                           <span class="keywordtype">size_t</span> size, </div>
<div class="line">                                                                           <span class="keywordtype">void</span> * cls),</div>
<div class="line">                                             <span class="keywordtype">void</span> * cls);</div>
<div class="ttc" id="agroup__instance_html_gafb2f3a9d7bbfbcf3acc0f9a88ab9507e"><div class="ttname"><a href="group__instance.html#gafb2f3a9d7bbfbcf3acc0f9a88ab9507e">ulfius_set_upload_file_callback_function</a></div><div class="ttdeci">int ulfius_set_upload_file_callback_function(struct _u_instance *u_instance, int(*file_upload_callback)(const struct _u_request *request, const char *key, const char *filename, const char *content_type, const char *transfer_encoding, const char *data, uint64_t off, size_t size, void *cls), void *cls)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1604</div></div>
</div><!-- fragment --><p>This callback function will be called before all the other callback functions, and be aware that not all parameters, especially URL parameters, will be present during the file upload callback function executions.</p>
<p>See <code>examples/sheep_counter</code> for a file upload example.</p>
<h2>Binary file upload <a class="anchor" id="binary-file-upload"></a></h2>
<p>By default, Ulfius will check input body data to be valid utf8 characters. This will most likely break binary files uploaded via <code>multipart/form-data</code> transfert-encoding.</p>
<p>If you don't or can't use <code>ulfius_set_upload_file_callback_function</code>, you must disable utf8 check before starting ulfius instance, then in the callback function, make sure to use <code>u_map_get_length</code> for every <code>request-&gt;map_post_body</code> element.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> callback_function(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">void</span> * user_data) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * file_data = <a class="code" href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a>(request-&gt;<a class="code" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">map_post_body</a>, <span class="stringliteral">&quot;file_parameter&quot;</span>);</div>
<div class="line">  <span class="keywordtype">size_t</span> file_size = <a class="code" href="group__u__map.html#gac587a323bcbcd7a31a47f08171e3fccd">u_map_get_length</a>(request-&gt;<a class="code" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">map_post_body</a>, <span class="stringliteral">&quot;file_parameter&quot;</span>);</div>
<div class="line">  <span class="comment">// process http request</span></div>
<div class="line">  <span class="comment">// [...]</span></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group__const.html#gab603d00690d16137b7cb52b597197a55">U_CALLBACK_CONTINUE</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">// initialize instance</span></div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="struct__u__instance.html">_u_instance</a> u_instance;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__instance.html#ga2d14cdd9291b8b8e9d46b1af8fd3b4a8">ulfius_init_instance</a>(&amp;u_instance, 8080, NULL, NULL);</div>
<div class="line">  u_instance.<a class="code" href="struct__u__instance.html#a8199ebaf5638f6d370172a596f466d68">check_utf8</a> = 0;</div>
<div class="line">  <a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(&amp;u_instance, <span class="stringliteral">&quot;POST&quot;</span>, <span class="stringliteral">&quot;/upload&quot;</span>, NULL, 0, &amp;callback_function, NULL);</div>
<div class="line">  <a class="code" href="group__instance.html#ga61e97f85ccc5381e4683794de16fbb96">ulfius_start_framework</a>(&amp;u_instance);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// The program continues...</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__u__map_html_gac587a323bcbcd7a31a47f08171e3fccd"><div class="ttname"><a href="group__u__map.html#gac587a323bcbcd7a31a47f08171e3fccd">u_map_get_length</a></div><div class="ttdeci">ssize_t u_map_get_length(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:433</div></div>
</div><!-- fragment --><h1>Streaming data <a class="anchor" id="streaming-data"></a></h1>
<p>If you need to stream data, i.e. send a variable and potentially large amount of data, or if you need to send a chunked response, you can define and use <code>stream_callback_function</code> in the <code>struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code>.</p>
<p>Not that if you stream data to the client, any data that was in the <code>response-&gt;binary_body</code> will be ignored. You must at least set the function pointer <code>struct <a class="el" href="struct__u__response.html#a470c3c4b25c0f773e3c879f1ad48f131">_u_response.stream_callback</a></code> to stream data. Set <code>stream_size</code> to U_STREAM_SIZE_UNKNOWN if you don't know the size of the data you need to send, like in audio stream for example. Set <code>stream_block_size</code> according to you system resources to avoid out of memory errors, also, set <code>stream_callback_free</code> with a pointer to a function that will free values allocated by your stream callback function, as a <code>close()</code> file for example, and finally, you can set <code>stream_user_data</code> to a pointer.</p>
<p>You can use the function <code>ulfius_set_stream_response</code> to set those parameters.</p>
<p>The prototype of the <code>stream_callback</code> function is the following:</p>
<div class="fragment"><div class="line">ssize_t stream_callback (<span class="keywordtype">void</span> * stream_user_data,  <span class="comment">// Your predefined user_data</span></div>
<div class="line">                         uint64_t offset,          <span class="comment">// the position of the current data to send</span></div>
<div class="line">                         <span class="keywordtype">char</span> * out_buf,           <span class="comment">// The output buffer to fill with data</span></div>
<div class="line">                         <span class="keywordtype">size_t</span> max);              <span class="comment">// the max size of data to be put in the out_buf</span></div>
</div><!-- fragment --><p>The return value must be the size of the data put in <code>out_buf</code>.</p>
<p>This function will be called over and over in loop as long as the client has the connection opened.</p>
<p>If you want to close the stream from the server side, return <code>U_STREAM_END</code> in the <code>stream_callback</code> function. If a problem occurred, you can close the connection with a <code>U_STREAM_ERROR</code> return value.</p>
<p>While the <code>stream_callback_free</code> function is as simple as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> stream_callback_free (<span class="keywordtype">void</span> * stream_user_data);</div>
</div><!-- fragment --><p>Check the application <code>stream_example</code> in the example folder.</p>
<h1>Websockets communication <a class="anchor" id="websockets-communication"></a></h1>
<p>The websocket protocol is defined in the <a href="https://tools.ietf.org/html/rfc6455">RFC6455</a>. A websocket is a full-duplex communication layer between a server and a client initiated by a HTTP request. Once the websocket handshake is complete between the client and the server, the TCP socket between them is kept open and messages in a specific format can be exchanged. Any side of the socket can send a message to the other side, which allows the server to push messages to the client.</p>
<p>Ulfius implements websocket communication, both server-side and client-side. The following chapter will describe how to create a websocket service or a websocket client by using callback functions. The framework will handle sending and receiving messages with the clients, and your application will deal with high level functions to facilitate the communication process.</p>
<h2>Websocket management <a class="anchor" id="websocket-management"></a></h2>
<p>During the websocket connection, you can either send messages, read the incoming messages, close the connection, or wait until the connection is closed by the client or by a network problem.</p>
<h2>Messages manipulation <a class="anchor" id="messages-manipulation"></a></h2>
<p>A websocket message has the following structure:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span>_websocket_message {</div>
<div class="line">  time_t  datestamp; <span class="comment">// datestamp when the message was transmitted</span></div>
<div class="line">  uint8_t rsv;       <span class="comment">// RSV (extension) flags, must be binary tested over U_WEBSOCKET_RSV1, U_WEBSOCKET_RSV2, U_WEBSOCKET_RSV3</span></div>
<div class="line">  uint8_t opcode;    <span class="comment">// opcode of the message: U_WEBSOCKET_OPCODE_TEXT, U_WEBSOCKET_OPCODE_BINARY, U_WEBSOCKET_OPCODE_PING, U_WEBSOCKET_OPCODE_PONG</span></div>
<div class="line">  uint8_t has_mask;  <span class="comment">// Flag to specify if the message has a mask</span></div>
<div class="line">  uint8_t mask[4];   <span class="comment">// mask</span></div>
<div class="line">  <span class="keywordtype">size_t</span>  data_len;  <span class="comment">// Length of the data payload</span></div>
<div class="line">  <span class="keywordtype">char</span>  * data;      <span class="comment">// data payload</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>The different opcode values available are the following:</p>
<div class="fragment"><div class="line">U_WEBSOCKET_OPCODE_TEXT</div>
<div class="line">U_WEBSOCKET_OPCODE_BINARY</div>
<div class="line">U_WEBSOCKET_OPCODE_CLOSE</div>
<div class="line">U_WEBSOCKET_OPCODE_PING</div>
</div><!-- fragment --><p>To send a message to the client, use the dedicated functions <code>ulfius_websocket_send_message</code>, <code>ulfius_websocket_send_fragmented_message</code> or <code>ulfius_websocket_send_json_message</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#ad53ce5b968d66afa962c85e17e326bbd">ulfius_websocket_send_message</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                  <span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                  <span class="keyword">const</span> uint64_t data_len,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">char</span> * data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#ad60f10e65b744bc9391c520e8f9245af">ulfius_websocket_send_fragmented_message</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                             <span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                             <span class="keyword">const</span> uint64_t data_len,</div>
<div class="line">                                             <span class="keyword">const</span> <span class="keywordtype">char</span> * data,</div>
<div class="line">                                             <span class="keyword">const</span> uint64_t fragment_len);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a89e1e61b8cfeb542d69d1d58c57271a0">ulfius_websocket_send_json_message</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                       json_t * j_message);</div>
<div class="ttc" id="au__websocket_8c_html_a89e1e61b8cfeb542d69d1d58c57271a0"><div class="ttname"><a href="u__websocket_8c.html#a89e1e61b8cfeb542d69d1d58c57271a0">ulfius_websocket_send_json_message</a></div><div class="ttdeci">int ulfius_websocket_send_json_message(struct _websocket_manager *websocket_manager, json_t *j_message)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1594</div></div>
<div class="ttc" id="au__websocket_8c_html_ad53ce5b968d66afa962c85e17e326bbd"><div class="ttname"><a href="u__websocket_8c.html#ad53ce5b968d66afa962c85e17e326bbd">ulfius_websocket_send_message</a></div><div class="ttdeci">int ulfius_websocket_send_message(struct _websocket_manager *websocket_manager, const uint8_t opcode, const uint64_t data_len, const char *data)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1582</div></div>
<div class="ttc" id="au__websocket_8c_html_ad60f10e65b744bc9391c520e8f9245af"><div class="ttname"><a href="u__websocket_8c.html#ad60f10e65b744bc9391c520e8f9245af">ulfius_websocket_send_fragmented_message</a></div><div class="ttdeci">int ulfius_websocket_send_fragmented_message(struct _websocket_manager *websocket_manager, const uint8_t opcode, const uint64_t data_len, const char *data, const uint64_t fragment_len)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1482</div></div>
</div><!-- fragment --><p>To get the first message of the incoming or outcoming if you need to with <code>ulfius_websocket_pop_first_message</code>, this will remove the first message of the list, and return it as a pointer. You must free the message using the function <code>ulfius_clear_websocket_message</code> after use:</p>
<p>All the sent or received messages are stored by default in the <code>struct _websocket_manager</code> attributes <code>message_list_incoming</code> and <code>message_list_outcoming</code>. To skip storing incoming and/or outcoming messages, you can set the flag <code>struct _websocket_manager.keep_messages</code> with the values <code>U_WEBSOCKET_KEEP_INCOMING</code>, <code>U_WEBSOCKET_KEEP_OUTCOMING</code> or <code>U_WEBSOCKET_KEEP_NONE</code>. The flag is set to default with <code>U_WEBSOCKET_KEEP_INCOMING|U_WEBSOCKET_KEEP_OUTCOMING</code>.</p>
<p>if you exchange messages in JSON format, you can use <code>ulfius_websocket_parse_json_message</code> to parse a <code>struct _websocket_message *</code> payload into a <code>json_t *</code> object.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">struct </span>_websocket_message * <a class="code" href="u__websocket_8c.html#ae768a7ec5f7e8be229d8c2642022c6ce">ulfius_websocket_pop_first_message</a>(<span class="keyword">struct</span> _websocket_message_list * message_list);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="u__websocket_8c.html#af4aada66b8cb2ccde8f6c5eccfbf35dd">ulfius_clear_websocket_message</a>(<span class="keyword">struct</span> _websocket_message * message);</div>
<div class="line"> </div>
<div class="line">json_t * <a class="code" href="u__websocket_8c.html#aed7ef5a6c6ded65662a4f6517d3dfb87">ulfius_websocket_parse_json_message</a>(<span class="keyword">const</span> <span class="keyword">struct</span> _websocket_message * message, json_error_t * json_error);</div>
<div class="ttc" id="au__websocket_8c_html_ae768a7ec5f7e8be229d8c2642022c6ce"><div class="ttname"><a href="u__websocket_8c.html#ae768a7ec5f7e8be229d8c2642022c6ce">ulfius_websocket_pop_first_message</a></div><div class="ttdeci">struct _websocket_message * ulfius_websocket_pop_first_message(struct _websocket_message_list *message_list)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1629</div></div>
<div class="ttc" id="au__websocket_8c_html_aed7ef5a6c6ded65662a4f6517d3dfb87"><div class="ttname"><a href="u__websocket_8c.html#aed7ef5a6c6ded65662a4f6517d3dfb87">ulfius_websocket_parse_json_message</a></div><div class="ttdeci">json_t * ulfius_websocket_parse_json_message(const struct _websocket_message *message, json_error_t *json_error)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1614</div></div>
<div class="ttc" id="au__websocket_8c_html_af4aada66b8cb2ccde8f6c5eccfbf35dd"><div class="ttname"><a href="u__websocket_8c.html#af4aada66b8cb2ccde8f6c5eccfbf35dd">ulfius_clear_websocket_message</a></div><div class="ttdeci">void ulfius_clear_websocket_message(struct _websocket_message *message)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1652</div></div>
</div><!-- fragment --><h3>Fragmented messages limitation in browsers <a class="anchor" id="fragmented-messages-limitation-in-browsers"></a></h3>
<p>It seems that some browsers like Firefox or Chromium don't like to receive fragmented messages, they will close the connection with a fragmented message is received. Use <code>ulfius_websocket_send_fragmented_message</code> with caution then.</p>
<h2>Server-side websocket <a class="anchor" id="server-side-websocket"></a></h2>
<h3>Open a websocket communication <a class="anchor" id="open-a-websocket-communication"></a></h3>
<p>To start a websocket communication between the client and your application, you must use the dedicated function <code>ulfius_start_websocket_cb</code> with proper values:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a9cf9d96944f3d4fc3930075011cbb4af">ulfius_set_websocket_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_protocol,</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_extensions, </div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_manager_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                        <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                        <span class="keywordtype">void</span> * websocket_manager_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_manager_user_data,</div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_incoming_message_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                                 <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                                 <span class="keyword">const</span> <span class="keyword">struct</span> _websocket_message * message,</div>
<div class="line">                                                                                 <span class="keywordtype">void</span> * websocket_incoming_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_incoming_user_data,</div>
<div class="line">                                   <span class="keywordtype">void</span> (* websocket_onclose_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                        <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                        <span class="keywordtype">void</span> * websocket_onclose_user_data),</div>
<div class="line">                                   <span class="keywordtype">void</span> * websocket_onclose_user_data);</div>
</div><!-- fragment --><p>According to the Websockets RFC, parameters <code>websocket_protocol</code> and <code>websocket_extensions</code> are specific for your application.</p>
<p>In Ulfius Implementation, if you specify a list of protocols as a string of protocol names, separated by a comma (<code>,</code>), Ulfius framework will check each one and see if they match the list of protocols specified by the client. The resulting protocol list will be sent back to the client. Likewise, the websocket extension is specific to your application, you can specify a list of websocket extension separated by a comma (<code>,</code>).</p>
<p>If no protocol match your list, the connection will be closed by the framework and will return an error 400 to the client. If you set a <code>NULL</code> value for the protocol and/or the extension, Ulfius will not accept any protocols and/or extension sent by the client, but the websocket connexion will be opened.</p>
<p>3 callback functions are available for the websocket implementation:</p>
<ul>
<li><code>websocket_manager_callback</code>: This function will be called in a separate thread, and the websocket will remain open as long as this callback function is not completed. In this function, your program will have access to the websocket status (connected or not), and the list of messages sent and received. When this function ends, the websocket will close itself automatically.</li>
<li><code>websocket_incoming_message_callback</code>: This function will be called every time a new message is sent by the client. Although, it is in synchronous mode, which means that you won't have 2 different <code>websocket_incoming_message_callback</code> of the same websocket executed at the same time.</li>
<li><code>websocket_onclose_callback</code>: This optional function will be called right after the websocket connection is closed, but before the websocket structure is cleaned.</li>
</ul>
<p>You must specify at least one of the callback functions between <code>websocket_manager_callback</code> or <code>websocket_incoming_message_callback</code>.</p>
<p>When the function <code>ulfius_stop_framework</code> is called, it will wait for all running websockets to end by themselves, there is no force close. So if you have a <code>websocket_manager_callback</code> function running, you <em>MUST</em> end this function in order to make a clean stop of the http daemon.</p>
<p>For each of these callback function, you can specify a <code>*_user_data</code> pointer containing any data you need.</p>
<h3>Advanced websocket extension <a class="anchor" id="advanced-websocket-extension"></a></h3>
<p>Since Ulfius 2.7.0, you have advanced functions to handle websocket extensions based on the functions <code>ulfius_add_websocket_extension_message_perform</code> for the server websockets and <code>ulfius_add_websocket_client_extension_message_perform</code> for the clients websockets.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a0cf4d520d6d538c4a37762b786a10e22">ulfius_add_websocket_extension_message_perform</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response,</div>
<div class="line">                                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * extension_server,</div>
<div class="line">                                                   <span class="keywordtype">int</span> (* websocket_extension_message_out_perform)(<span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                                                                                   uint8_t * rsv,</div>
<div class="line">                                                                                                   <span class="keyword">const</span> uint64_t data_len_in,</div>
<div class="line">                                                                                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * data_in,</div>
<div class="line">                                                                                                   uint64_t * data_len_out,</div>
<div class="line">                                                                                                   <span class="keywordtype">char</span> ** data_out,</div>
<div class="line">                                                                                                   <span class="keyword">const</span> uint64_t fragment_len,</div>
<div class="line">                                                                                                   <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                   <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                   <span class="keywordtype">void</span> * websocket_extension_message_out_perform_user_data,</div>
<div class="line">                                                   <span class="keywordtype">int</span> (* websocket_extension_message_in_perform)(<span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                                                                                  uint8_t rsv,</div>
<div class="line">                                                                                                  <span class="keyword">const</span> uint64_t data_len_in,</div>
<div class="line">                                                                                                  <span class="keyword">const</span> <span class="keywordtype">char</span> * data_in,</div>
<div class="line">                                                                                                  uint64_t * data_len_out,</div>
<div class="line">                                                                                                  <span class="keywordtype">char</span> ** data_out,</div>
<div class="line">                                                                                                  <span class="keyword">const</span> uint64_t fragment_len,</div>
<div class="line">                                                                                                  <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                  <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                   <span class="keywordtype">void</span> * websocket_extension_message_in_perform_user_data,</div>
<div class="line">                                                   <span class="keywordtype">int</span> (* websocket_extension_server_match)(<span class="keyword">const</span> <span class="keywordtype">char</span> * extension_client,</div>
<div class="line">                                                                                            <span class="keyword">const</span> <span class="keywordtype">char</span> ** extension_client_list,</div>
<div class="line">                                                                                            <span class="keywordtype">char</span> ** extension_server,</div>
<div class="line">                                                                                            <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                            <span class="keywordtype">void</span> ** context),</div>
<div class="line">                                                   <span class="keywordtype">void</span> * websocket_extension_server_match_user_data,</div>
<div class="line">                                                   <span class="keywordtype">void</span> (* websocket_extension_free_context)(<span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                             <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                   <span class="keywordtype">void</span>  * websocket_extension_free_context_user_data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a4679f65c4fe7965403b3711e28d814e6">ulfius_add_websocket_client_extension_message_perform</a>(<span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler,</div>
<div class="line">                                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * extension,</div>
<div class="line">                                                          <span class="keywordtype">int</span> (* websocket_extension_message_out_perform)(<span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                                                                                          uint8_t * rsv,</div>
<div class="line">                                                                                                          <span class="keyword">const</span> uint64_t data_len_in,</div>
<div class="line">                                                                                                          <span class="keyword">const</span> <span class="keywordtype">char</span> * data_in,</div>
<div class="line">                                                                                                          uint64_t * data_len_out,</div>
<div class="line">                                                                                                          <span class="keywordtype">char</span> ** data_out,</div>
<div class="line">                                                                                                          <span class="keyword">const</span> uint64_t fragment_len,</div>
<div class="line">                                                                                                          <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                          <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                          <span class="keywordtype">void</span> * websocket_extension_message_out_perform_user_data,</div>
<div class="line">                                                          <span class="keywordtype">int</span> (* websocket_extension_message_in_perform)(<span class="keyword">const</span> uint8_t opcode,</div>
<div class="line">                                                                                                         uint8_t rsv,</div>
<div class="line">                                                                                                         <span class="keyword">const</span> uint64_t data_len_in,</div>
<div class="line">                                                                                                         <span class="keyword">const</span> <span class="keywordtype">char</span> * data_in,</div>
<div class="line">                                                                                                         uint64_t * data_len_out,</div>
<div class="line">                                                                                                         <span class="keywordtype">char</span> ** data_out,</div>
<div class="line">                                                                                                         <span class="keyword">const</span> uint64_t fragment_len,</div>
<div class="line">                                                                                                         <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                         <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                          <span class="keywordtype">void</span> * websocket_extension_message_in_perform_user_data,</div>
<div class="line">                                                          <span class="keywordtype">int</span> (* websocket_extension_client_match)(<span class="keyword">const</span> <span class="keywordtype">char</span> * extension_server,</div>
<div class="line">                                                                                                   <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                   <span class="keywordtype">void</span> ** context),</div>
<div class="line">                                                          <span class="keywordtype">void</span> * websocket_extension_client_match_user_data,</div>
<div class="line">                                                          <span class="keywordtype">void</span> (* websocket_extension_free_context)(<span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                                                                                    <span class="keywordtype">void</span> * context),</div>
<div class="line">                                                          <span class="keywordtype">void</span>  * websocket_extension_free_context_user_data);</div>
<div class="ttc" id="au__websocket_8c_html_a0cf4d520d6d538c4a37762b786a10e22"><div class="ttname"><a href="u__websocket_8c.html#a0cf4d520d6d538c4a37762b786a10e22">ulfius_add_websocket_extension_message_perform</a></div><div class="ttdeci">int ulfius_add_websocket_extension_message_perform(struct _u_response *response, const char *extension_server, uint8_t rsv, int(*websocket_extension_message_out_perform)(const uint8_t opcode, const uint64_t data_len_in, const char *data_in, uint64_t *data_len_out, char **data_out, const uint64_t fragment_len, void *user_data, void *context), void *websocket_extension_message_out_perform_user_data, int(*websocket_extension_message_in_perform)(const uint8_t opcode, const uint64_t data_len_in, const char *data_in, uint64_t *data_len_out, char **data_out, const uint64_t fragment_len, void *user_data, void *context), void *websocket_extension_message_in_perform_user_data, int(*websocket_extension_server_match)(const char *extension_client, const char **extension_client_list, char **extension_server, void *user_data, void **context), void *websocket_extension_server_match_user_data, void(*websocket_extension_free_context)(void *user_data, void *context), void *websocket_extension_free_context_user_data)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:1881</div></div>
<div class="ttc" id="au__websocket_8c_html_a4679f65c4fe7965403b3711e28d814e6"><div class="ttname"><a href="u__websocket_8c.html#a4679f65c4fe7965403b3711e28d814e6">ulfius_add_websocket_client_extension_message_perform</a></div><div class="ttdeci">int ulfius_add_websocket_client_extension_message_perform(struct _websocket_client_handler *websocket_client_handler, const char *extension, uint8_t rsv, int(*websocket_extension_message_out_perform)(const uint8_t opcode, const uint64_t data_len_in, const char *data_in, uint64_t *data_len_out, char **data_out, const uint64_t fragment_len, void *user_data, void *context), void *websocket_extension_message_out_perform_user_data, int(*websocket_extension_message_in_perform)(const uint8_t opcode, const uint64_t data_len_in, const char *data_in, uint64_t *data_len_out, char **data_out, const uint64_t fragment_len, void *user_data, void *context), void *websocket_extension_message_in_perform_user_data, int(*websocket_extension_client_match)(const char *extension_server, void *user_data, void **context), void *websocket_extension_client_match_user_data, void(*websocket_extension_free_context)(void *user_data, void *context), void *websocket_extension_free_context_user_data)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2438</div></div>
</div><!-- fragment --><p>These functions add the possibility to run a callback function before a message is sent and/or after a message is received.</p>
<p>The callback functions <code>websocket_extension_server_match</code> and <code>websocket_extension_client_match</code> can be use if you expect to match an extension with parameters. If <code>NULL</code>, then instead an exact match between <code>const char * extension</code> and the extension received will be checked to enable or not this extension callback functions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> websocket_extension_server_match(<span class="keyword">const</span> <span class="keywordtype">char</span> * extension_client,</div>
<div class="line">                                     <span class="keyword">const</span> <span class="keywordtype">char</span> ** extension_client_list,</div>
<div class="line">                                     <span class="keywordtype">char</span> ** extension_server,</div>
<div class="line">                                     <span class="keywordtype">void</span> * user_data,</div>
<div class="line">                                     <span class="keywordtype">void</span> ** context);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> websocket_extension_client_match(<span class="keyword">const</span> <span class="keywordtype">char</span> * extension_server, <span class="keywordtype">void</span> * user_data, <span class="keywordtype">void</span> ** context);</div>
</div><!-- fragment --><p>The callback function <code>websocket_extension_message_out_perform</code> can modify the message data and data lenght and the RSV flags. The callback function <code>websocket_extension_message_in_perform</code> can modify the message data only. Inside these functions, <code>data_in</code> and <code>data_len_in</code> are the current data, your extension callback function must update <code>data_out</code> with a <code>o_malloc</code>'ed data and set the new data length using <code>data_len_out</code> and return <code>U_OK</code> on success. If your function doesn't return <code>U_OK</code>, the message data won't be updated and <code>data_out</code> won't be free'd if set.</p>
<p>You can call <code>ulfius_add_websocket_extension_message_perform</code> or <code>ulfius_add_websocket_client_extension_message_perform</code> multiple times for a websocket definition. In that case the extension callbacks function will be called in the same order for the <code>websocket_extension_message_out_perform</code> callbacks, and in reverse order for the <code>websocket_extension_message_in_perform</code> callbacks.</p>
<h3>Built-in server extension permessage-deflate <a class="anchor" id="built-in-server-extension-permessage-deflate"></a></h3>
<p>The Websocket extension <a href="https://tools.ietf.org/html/rfc7692">permessage-deflate</a> used to compress the message data is available in Ulfius. To use this extension in your websocket server, you must call <code>ulfius_add_websocket_deflate_extension</code> after calling <code>ulfius_set_websocket_response</code> and before finishing the callback endpoint.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#aae44bce07195bd06816b0425bbb13005">ulfius_add_websocket_deflate_extension</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="ttc" id="au__websocket_8c_html_aae44bce07195bd06816b0425bbb13005"><div class="ttname"><a href="u__websocket_8c.html#aae44bce07195bd06816b0425bbb13005">ulfius_add_websocket_deflate_extension</a></div><div class="ttdeci">int ulfius_add_websocket_deflate_extension(struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2266</div></div>
</div><!-- fragment --><p>See the sample code in <a href="example_programs/websocket_example/websocket_server.c">websocket_example/websocket_server.c</a></p>
<h3>Close a websocket communication <a class="anchor" id="close-a-websocket-communication"></a></h3>
<p>To close a websocket communication from the server, you can do one of the following:</p>
<ul>
<li>End the function <code>websocket_manager_callback</code>, it will result in closing the websocket connection</li>
<li>Send a message with the opcode <code>U_WEBSOCKET_OPCODE_CLOSE</code></li>
<li>Call the function <code>ulfius_websocket_wait_close</code> or <code>ulfius_websocket_send_close_signal</code> described below</li>
</ul>
<p>If no <code>websocket_manager_callback</code> is specified, you can send a <code>U_WEBSOCKET_OPCODE_CLOSE</code> in the <code>websocket_incoming_message_callback</code> function when you need, or call the function <code>ulfius_websocket_send_close_signal</code>.</p>
<p>If a callback function <code>websocket_onclose_callback</code> has been specified, this function will be executed on every case at the end of the websocket connection.</p>
<p>If the websocket handshake hasn't been correctly completed or if an error appears during the handshake connection, the callback <code>websocket_onclose_callback</code> will be called anyway, even if the callback functions <code>websocket_manager_callback</code> or <code>websocket_incoming_message_callback</code> are skipped due to no websocket connection. This is to allow the calling program to close opened resources or clean allocated memory. Beware that in this specific case, the parameter <code>struct _websocket_manager * websocket_manager</code> may be <code>NULL</code>.</p>
<h3>Websocket status <a class="anchor" id="websocket-status"></a></h3>
<p>The following functions allow the application to know if the the websocket is still open, to enforce closing the websocket or to wait until the websocket is closed by the client:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a1738c8572795e4264c250a2a7d5ed2ee">ulfius_websocket_send_close_signal</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a86e85c4ffc47c3161f6b016ec56fb3e7">ulfius_websocket_status</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a55edeedda06a0a1d1792da77bef54cb4">ulfius_websocket_wait_close</a>(<span class="keyword">struct</span> _websocket_manager * websocket_manager, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeout);</div>
<div class="ttc" id="au__websocket_8c_html_a1738c8572795e4264c250a2a7d5ed2ee"><div class="ttname"><a href="u__websocket_8c.html#a1738c8572795e4264c250a2a7d5ed2ee">ulfius_websocket_send_close_signal</a></div><div class="ttdeci">int ulfius_websocket_send_close_signal(struct _websocket_manager *websocket_manager)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2278</div></div>
<div class="ttc" id="au__websocket_8c_html_a55edeedda06a0a1d1792da77bef54cb4"><div class="ttname"><a href="u__websocket_8c.html#a55edeedda06a0a1d1792da77bef54cb4">ulfius_websocket_wait_close</a></div><div class="ttdeci">int ulfius_websocket_wait_close(struct _websocket_manager *websocket_manager, unsigned int timeout)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2307</div></div>
<div class="ttc" id="au__websocket_8c_html_a86e85c4ffc47c3161f6b016ec56fb3e7"><div class="ttname"><a href="u__websocket_8c.html#a86e85c4ffc47c3161f6b016ec56fb3e7">ulfius_websocket_status</a></div><div class="ttdeci">int ulfius_websocket_status(struct _websocket_manager *websocket_manager)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2293</div></div>
</div><!-- fragment --><h2>Client-side websocket <a class="anchor" id="client-side-websocket"></a></h2>
<p>Ulfius allows to create a websocket connection as a client. The behavior is quite similar to the server-side websocket. The application will open a websocket connection specified by a <code>struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code>, and a set of callback functions to manage the websocket once connected.</p>
<h3>Prepare the request <a class="anchor" id="prepare-the-request"></a></h3>
<p>You can manually fill the <code>struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code> with your parameters or use the dedicated function <code>ulfius_set_websocket_request</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#ad33e95eec6131d591555cc9e51e43512">ulfius_set_websocket_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">char</span> * url,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_protocol,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keywordtype">char</span> * websocket_extensions);</div>
<div class="ttc" id="au__websocket_8c_html_ad33e95eec6131d591555cc9e51e43512"><div class="ttname"><a href="u__websocket_8c.html#ad33e95eec6131d591555cc9e51e43512">ulfius_set_websocket_request</a></div><div class="ttdeci">int ulfius_set_websocket_request(struct _u_request *request, const char *url, const char *websocket_protocol, const char *websocket_extensions)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2396</div></div>
</div><!-- fragment --><p>The <code>url</code> specified must have one of the following form:</p><ul>
<li><code><a href="http://">http://</a>&lt;websocket_url&gt;</code></li>
<li><code>ws://&lt;websocket_url&gt;</code></li>
<li><code><a href="https://">https://</a>&lt;websocket_url&gt;</code></li>
<li><code>wss://&lt;websocket_url&gt;</code></li>
</ul>
<p>The <code>websocket_protocol</code> and <code>websocket_extensions</code> values are optional. To specify multiple protocol, you must separate them with the comma <code>,</code> character. To specify multiple extensions, you must separate them with the semicolon <code>;</code> character.</p>
<p>You can also specify additional headers or cookies to the request.</p>
<p>Any body parameter or body raw value will be ignored, the header <code>Content-Length</code> will be set to 0.</p>
<p>The header <code>User-Agent</code> value will be <code>Ulfius Websocket Client Framework</code>, feel free to modify it afterwards if you need.</p>
<h3>Built-in client extension permessage-deflate <a class="anchor" id="built-in-client-extension-permessage-deflate"></a></h3>
<p>The Websocket extension <a href="https://tools.ietf.org/html/rfc7692">permessage-deflate</a> used to compress the message data is available in Ulfius. To use this extension in your websocket client, you must call <code>ulfius_add_websocket_client_deflate_extension</code> after calling <code>ulfius_set_websocket_request</code> and before calling <code>ulfius_open_websocket_client_connection</code>. Also, the parameter <code>struct _websocket_client_handler</code> must be initialized to <code>{NULL, NULL}</code> before calling <code>ulfius_set_websocket_request</code>.</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * Adds the required extension message perform to implement message compression according to</div>
<div class="line"> * RFC 7692: Compression Extensions for WebSocket</div>
<div class="line"> * https://tools.ietf.org/html/rfc7692</div>
<div class="line"> * @param websocket_client_handler the handler of the websocket</div>
<div class="line"> * @return U_OK on success</div>
<div class="line"> */</div>
<div class="line">int ulfius_add_websocket_client_deflate_extension(struct _websocket_client_handler * websocket_client_handler);</div>
</div><!-- fragment --><p>See the sample code in <a href="example_programs/websocket_example/websocket_client.c">websocket_example/websocket_client.c</a></p>
<h3>Opening the websocket connection <a class="anchor" id="opening-the-websocket-connection"></a></h3>
<p>Once the request is completed, you can open the websocket connection with <code>ulfius_open_websocket_client_connection</code>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a996074d603ae74f46fe2a39fbb3ac921">ulfius_open_websocket_client_connection</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                            <span class="keywordtype">void</span> (* websocket_manager_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                                 <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                                 <span class="keywordtype">void</span> * websocket_manager_user_data),</div>
<div class="line">                                            <span class="keywordtype">void</span> * websocket_manager_user_data,</div>
<div class="line">                                            <span class="keywordtype">void</span> (* websocket_incoming_message_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                                          <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                                          <span class="keyword">const</span> <span class="keyword">struct</span> _websocket_message * message,</div>
<div class="line">                                                                                          <span class="keywordtype">void</span> * websocket_incoming_user_data),</div>
<div class="line">                                            <span class="keywordtype">void</span> * websocket_incoming_user_data,</div>
<div class="line">                                            <span class="keywordtype">void</span> (* websocket_onclose_callback) (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request,</div>
<div class="line">                                                                                 <span class="keyword">struct</span> _websocket_manager * websocket_manager,</div>
<div class="line">                                                                                 <span class="keywordtype">void</span> * websocket_onclose_user_data),</div>
<div class="line">                                            <span class="keywordtype">void</span> * websocket_onclose_user_data,</div>
<div class="line">                                            <span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler);</div>
<div class="ttc" id="au__websocket_8c_html_a996074d603ae74f46fe2a39fbb3ac921"><div class="ttname"><a href="u__websocket_8c.html#a996074d603ae74f46fe2a39fbb3ac921">ulfius_open_websocket_client_connection</a></div><div class="ttdeci">int ulfius_open_websocket_client_connection(struct _u_request *request, void(*websocket_manager_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, void *websocket_manager_user_data), void *websocket_manager_user_data, void(*websocket_incoming_message_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, const struct _websocket_message *message, void *websocket_incoming_user_data), void *websocket_incoming_user_data, void(*websocket_onclose_callback)(const struct _u_request *request, struct _websocket_manager *websocket_manager, void *websocket_onclose_user_data), void *websocket_onclose_user_data, struct _websocket_client_handler *websocket_client_handler, struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2524</div></div>
</div><!-- fragment --><p>If the websocket connection is established, <code>U_OK</code> will be returned and the websocket connection will be executed in a separate thread.</p>
<h3>Closing a websocket communication <a class="anchor" id="closing-a-websocket-communication"></a></h3>
<p>To close a websocket communication, you can do one of the following:</p>
<ul>
<li>End the function <code>websocket_manager_callback</code>, it will result in closing the websocket connection</li>
<li>Send a message with the opcode <code>U_WEBSOCKET_OPCODE_CLOSE</code></li>
<li>Call the function <code>ulfius_websocket_wait_close</code> described below, this function will return U_OK when the websocket is closed</li>
<li>Call the function <code>ulfius_websocket_client_connection_send_close_signal</code> described below, this function is non-blocking, it will send a closing signal to the websocket and will return even if the websocket is still open. You can use <code>ulfius_websocket_wait_close</code> or <code>ulfius_websocket_client_connection_status</code> to check if the websocket is closed.</li>
</ul>
<p><em>Note - broken pipe</em></p>
<p>In some cases, when the client websocket connection is secured via TLS. If the connection is already closed, or broken, a <code>SIGPIPE</code> signal can occur, leading to a program crash. To avoid this issue, you can handle <code>SIGPIPE</code> signals using <code>sigaction</code>.</p>
<p>The following code is a simple example where all SIGPIPE signals are simply ignored:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line">sigaction(SIGPIPE, &amp;(<span class="keyword">struct</span> sigaction){SIG_IGN}, NULL);</div>
</div><!-- fragment --><p>Check the <code>sigaction</code> documentation for more details.</p>
<h2>Client Websocket status <a class="anchor" id="client-websocket-status"></a></h2>
<p>The following functions allow the application to know if the the websocket is still open, to enforce closing the websocket or to wait until the websocket is closed by the server:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a0f01cd89ce14766ebb9572645e36ec8f">ulfius_websocket_client_connection_send_close_signal</a>(<span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#ad193bf928fd587b3fdad653bd7c82301">ulfius_websocket_client_connection_close</a>(<span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a48680b98db86851f2273ab2d22f8e61d">ulfius_websocket_client_connection_status</a>(<span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="u__websocket_8c.html#a44701d788570a3a6ae72102786c261fd">ulfius_websocket_client_connection_wait_close</a>(<span class="keyword">struct</span> _websocket_client_handler * websocket_client_handler, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeout);</div>
<div class="ttc" id="au__websocket_8c_html_a0f01cd89ce14766ebb9572645e36ec8f"><div class="ttname"><a href="u__websocket_8c.html#a0f01cd89ce14766ebb9572645e36ec8f">ulfius_websocket_client_connection_send_close_signal</a></div><div class="ttdeci">int ulfius_websocket_client_connection_send_close_signal(struct _websocket_client_handler *websocket_client_handler)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2761</div></div>
<div class="ttc" id="au__websocket_8c_html_a44701d788570a3a6ae72102786c261fd"><div class="ttname"><a href="u__websocket_8c.html#a44701d788570a3a6ae72102786c261fd">ulfius_websocket_client_connection_wait_close</a></div><div class="ttdeci">int ulfius_websocket_client_connection_wait_close(struct _websocket_client_handler *websocket_client_handler, unsigned int timeout)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2815</div></div>
<div class="ttc" id="au__websocket_8c_html_a48680b98db86851f2273ab2d22f8e61d"><div class="ttname"><a href="u__websocket_8c.html#a48680b98db86851f2273ab2d22f8e61d">ulfius_websocket_client_connection_status</a></div><div class="ttdeci">int ulfius_websocket_client_connection_status(struct _websocket_client_handler *websocket_client_handler)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2801</div></div>
<div class="ttc" id="au__websocket_8c_html_ad193bf928fd587b3fdad653bd7c82301"><div class="ttname"><a href="u__websocket_8c.html#ad193bf928fd587b3fdad653bd7c82301">ulfius_websocket_client_connection_close</a></div><div class="ttdeci">int ulfius_websocket_client_connection_close(struct _websocket_client_handler *websocket_client_handler)</div><div class="ttdef"><b>Definition:</b> u_websocket.c:2774</div></div>
</div><!-- fragment --><h1>Outgoing request functions <a class="anchor" id="outgoing-request-functions"></a></h1>
<p>Ulfius allows output functions to send HTTP or SMTP requests. These functions use <code>libcurl</code>. You can disable these functions by appending the argument <code>CURLFLAG=1</code> when you build the library with Makefile or by disabling the flag in CMake build:</p>
<div class="fragment"><div class="line">$ make CURLFLAG=1 # Makefile</div>
<div class="line">$ cmake -DWITH_CURL=off # CMake</div>
</div><!-- fragment --><h2>Send HTTP request API <a class="anchor" id="send-http-request-api"></a></h2>
<p>The functions <code>int <a class="el" href="group__http__smtp__client.html#gac63db90a4e78f6c86b559c8fb96251e4">ulfius_send_http_request(const struct _u_request * request, struct _u_response * response)</a></code> and <code>int ulfius_send_http_streaming_request(const struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a> * request, struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a> * response, size_t (* write_body_function)(void * contents, size_t size, size_t nmemb, void * user_data), void * write_body_data)</code> are based on <code>libcurl</code> API.</p>
<p>They allow to send an HTTP request with the parameters specified by the <code><a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code> structure. Use the parameter <code><a class="el" href="struct__u__request.html#ae1b2bb23752f9f54829845b38f7cdeb0">_u_request.http_url</a></code> to specify the distant URL to call.</p>
<p>You can fill the maps in the <code><a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code> structure with parameters, they will be used to build the request. Note that if you fill <code><a class="el" href="struct__u__request.html#a78094a8748f9bd47411e48a1839bfc24">_u_request.map_post_body</a></code> with parameters, the content-type <code>application/x-www-form-urlencoded</code> will be used to encode the data.</p>
<p>The response parameters is stored into the <code><a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code> structure. If you specify NULL for the response structure, the http call will still be made but no response details will be returned. If you use <code>ulfius_send_http_request</code>, the response body will be stored in the parameter <code>response-&gt;*body*</code>.</p>
<p>If you use <code>ulfius_send_http_streaming_request</code>, the response body will be available in the <code>write_body_function</code> specified in the call. The <code>ulfius_send_http_streaming_request</code> can be used for streaming data or large response, or if you need to receive a checked response from the server.</p>
<p>Return value is <code>U_OK</code> on success.</p>
<p>This functions are defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#gac63db90a4e78f6c86b559c8fb96251e4">ulfius_send_http_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#ga42a42793722765c3bc2848eecf884198">ulfius_send_http_streaming_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, </div>
<div class="line">                                       <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, </div>
<div class="line">                                       <span class="keywordtype">size_t</span> (* write_body_function)(<span class="keywordtype">void</span> * contents, </div>
<div class="line">                                                                      <span class="keywordtype">size_t</span> size, </div>
<div class="line">                                                                      <span class="keywordtype">size_t</span> nmemb, </div>
<div class="line">                                                                      <span class="keywordtype">void</span> * user_data), </div>
<div class="line">                                       <span class="keywordtype">void</span> * write_body_data);</div>
<div class="ttc" id="agroup__http__smtp__client_html_ga42a42793722765c3bc2848eecf884198"><div class="ttname"><a href="group__http__smtp__client.html#ga42a42793722765c3bc2848eecf884198">ulfius_send_http_streaming_request</a></div><div class="ttdeci">int ulfius_send_http_streaming_request(const struct _u_request *request, struct _u_response *response, size_t(*write_body_function)(void *contents, size_t size, size_t nmemb, void *user_data), void *write_body_data)</div><div class="ttdef"><b>Definition:</b> u_send_request.c:194</div></div>
<div class="ttc" id="agroup__http__smtp__client_html_gac63db90a4e78f6c86b559c8fb96251e4"><div class="ttname"><a href="group__http__smtp__client.html#gac63db90a4e78f6c86b559c8fb96251e4">ulfius_send_http_request</a></div><div class="ttdeci">int ulfius_send_http_request(const struct _u_request *request, struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_send_request.c:162</div></div>
</div><!-- fragment --><h2>Send SMTP request API <a class="anchor" id="send-smtp-request-api"></a></h2>
<p>The function <code>ulfius_send_smtp_email</code> is used to send emails using a smtp server. It is based on <code>libcurl</code> API. It's used to send plain/text emails via a smtp server. The function <code>ulfius_send_smtp_rich_email</code> is used to send an e-mail with a specified content-type.</p>
<p>The functions are defined as:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#ga2403cd5bffb26626a9911f34806aa3e5">ulfius_send_smtp_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * host, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> port, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> use_tls, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> verify_certificate, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * user, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * password, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * from, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * to, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * cc, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * bcc, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * subject, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * mail_body);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#gac07e9171405530b7b13c9b82b4e6845f">ulfius_send_smtp_rich_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * host, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> port, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> use_tls, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> verify_certificate, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * user, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * password, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * from, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * to, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * cc, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * bcc, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * content_type,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * subject, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * mail_body);</div>
<div class="ttc" id="agroup__http__smtp__client_html_ga2403cd5bffb26626a9911f34806aa3e5"><div class="ttname"><a href="group__http__smtp__client.html#ga2403cd5bffb26626a9911f34806aa3e5">ulfius_send_smtp_email</a></div><div class="ttdeci">int ulfius_send_smtp_email(const char *host, const int port, const int use_tls, const int verify_certificate, const char *user, const char *password, const char *from, const char *to, const char *cc, const char *bcc, const char *subject, const char *mail_body)</div><div class="ttdef"><b>Definition:</b> u_send_request.c:913</div></div>
<div class="ttc" id="agroup__http__smtp__client_html_gac07e9171405530b7b13c9b82b4e6845f"><div class="ttname"><a href="group__http__smtp__client.html#gac07e9171405530b7b13c9b82b4e6845f">ulfius_send_smtp_rich_email</a></div><div class="ttdeci">int ulfius_send_smtp_rich_email(const char *host, const int port, const int use_tls, const int verify_certificate, const char *user, const char *password, const char *from, const char *to, const char *cc, const char *bcc, const char *content_type, const char *subject, const char *mail_body)</div><div class="ttdef"><b>Definition:</b> u_send_request.c:709</div></div>
</div><!-- fragment --><h1>Miscellaneous functions</h1>
<h2>Escape/Unescape string for url</h2>
<p>Ulfius includes the functions <code>ulfius_url_decode</code> and <code>ulfius_url_encode</code> to transform a string into url-safe string and vice-versa. Both functions take a string in input and return a head-allocated string as output that must be u_free'd after use. Note: In the callback functions, the <code>request-&gt;map_url</code> values are already url-decoded by the framework.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__url__encode.html#gaee0c27433bba6b1b015c3ce17012d81e">ulfius_url_decode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * str);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__url__encode.html#ga04b4082687a4ee377d9d53bdf9838a69">ulfius_url_encode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * str);</div>
<div class="ttc" id="agroup__url__encode_html_ga04b4082687a4ee377d9d53bdf9838a69"><div class="ttname"><a href="group__url__encode.html#ga04b4082687a4ee377d9d53bdf9838a69">ulfius_url_encode</a></div><div class="ttdeci">char * ulfius_url_encode(const char *str)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1843</div></div>
<div class="ttc" id="agroup__url__encode_html_gaee0c27433bba6b1b015c3ce17012d81e"><div class="ttname"><a href="group__url__encode.html#gaee0c27433bba6b1b015c3ce17012d81e">ulfius_url_decode</a></div><div class="ttdeci">char * ulfius_url_decode(const char *str)</div><div class="ttdef"><b>Definition:</b> ulfius.c:1877</div></div>
</div><!-- fragment --><h2>Export struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a> * and struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a> * in HTTP/1.1 stream format</h2>
<p>Those functions can be useful to debug requests or responses, or can be used to demonstrate how their respective parameters are translated in HTTP language.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__request__response__cookie.html#ga71e72955ae2d985b226812acbbde3d05">ulfius_export_request_http</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> * <a class="code" href="group__request__response__cookie.html#gaa18c905bb86a4727a8988563958138a5">ulfius_export_response_http</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="ttc" id="agroup__request__response__cookie_html_ga71e72955ae2d985b226812acbbde3d05"><div class="ttname"><a href="group__request__response__cookie.html#ga71e72955ae2d985b226812acbbde3d05">ulfius_export_request_http</a></div><div class="ttdeci">char * ulfius_export_request_http(const struct _u_request *request)</div><div class="ttdef"><b>Definition:</b> u_request.c:792</div></div>
<div class="ttc" id="agroup__request__response__cookie_html_gaa18c905bb86a4727a8988563958138a5"><div class="ttname"><a href="group__request__response__cookie.html#gaa18c905bb86a4727a8988563958138a5">ulfius_export_response_http</a></div><div class="ttdeci">char * ulfius_export_response_http(const struct _u_response *response)</div><div class="ttdef"><b>Definition:</b> u_response.c:725</div></div>
</div><!-- fragment --><h1>struct <a class="el" href="struct__u__map.html">_u_map</a> API <a class="anchor" id="struct-_u_map-api"></a></h1>
<p>The <code>struct <a class="el" href="struct__u__map.html">_u_map</a></code> is a simple key/value mapping API used in the requests and the response for setting parameters. The available functions to use this structure are:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga02376e930041dbe8853d3534822ea2dd">u_map_init</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * map);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga10cc4ab7d9ac763c5ad796fdb5b16fbd">u_map_clean</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga9ec83ad81a06506bb9507ebb61823da2">u_map_clean_full</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga96d481cf8bdd6cd466f5b360751a1a7c">u_map_clean_enum</a>(<span class="keywordtype">char</span> ** array);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> ** <a class="code" href="group__u__map.html#gab241a1b9bbcac7f1af2c7f3a8bb132e0">u_map_enum_keys</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> ** <a class="code" href="group__u__map.html#gad55e431c22bbb69a455fa39d8b9584dd">u_map_enum_values</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gad61561e48ffa6f7a80f1c15d91606fa8">u_map_has_key</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga881efcb2a98dd99d3375cd52d8ff06c5">u_map_has_value</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gad4fd82aa40847e950a58c13e5fcf36ce">u_map_has_value_binary</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * value, <span class="keywordtype">size_t</span> length);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gab87926da729050a12664a3dc0c38aed6">u_map_has_key_case</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga8dc8f629b2552c4a8a2be2c9e1a126f3">u_map_has_value_case</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gad1cbdd2ac4cbeb298304d8c949e007df">u_map_put</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gae31d780705f94084efd41128fcde38a1">u_map_put_binary</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">const</span> <span class="keywordtype">char</span> * value, uint64_t offset, <span class="keywordtype">size_t</span> length);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> <a class="code" href="group__u__map.html#gac587a323bcbcd7a31a47f08171e3fccd">u_map_get_length</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> <a class="code" href="group__u__map.html#ga299521474aa3576ac4cbea3709eba438">u_map_get_case_length</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__u__map.html#ga37a1c2e6b3e7213231ad7ca8d797c479">u_map_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="group__u__map.html#gae971b2cf87da3d5496a60a40aa68f32d">u_map_get_case</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga05b3f11fb5b30dfeded798d2f2b7cbd9">u_map_remove_from_key</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga5310869120a986c4956034ecdf0d635a">u_map_remove_from_key_case</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gad9cb68cfafecc2aac92c22730da74715">u_map_remove_from_value</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga1c6bf1ab52f6290c8c11c246479f2f3f">u_map_remove_from_value_case</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * value);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga035625587b16aa8febe22b2de707549b">u_map_remove_from_value_binary</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keywordtype">size_t</span> length);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#ga12122eac6ff17d166455155ea3fcb21b">u_map_remove_at</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * u_map, <span class="keyword">const</span> <span class="keywordtype">int</span> index);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct__u__map.html">_u_map</a> * <a class="code" href="group__u__map.html#ga26b4e475f998a0262e88ca0b201712f9">u_map_copy</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * source);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gac77ddb13f899cf8a414e8e2a35222a7d">u_map_copy_into</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * source, <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * target);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__u__map.html#gae5d012257f0f6c2d48088d147e1e7f9e">u_map_count</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__map.html">_u_map</a> * source);</div>
<div class="ttc" id="agroup__u__map_html_ga02376e930041dbe8853d3534822ea2dd"><div class="ttname"><a href="group__u__map.html#ga02376e930041dbe8853d3534822ea2dd">u_map_init</a></div><div class="ttdeci">int u_map_init(struct _u_map *u_map)</div><div class="ttdef"><b>Definition:</b> u_map.c:32</div></div>
<div class="ttc" id="agroup__u__map_html_ga035625587b16aa8febe22b2de707549b"><div class="ttname"><a href="group__u__map.html#ga035625587b16aa8febe22b2de707549b">u_map_remove_from_value_binary</a></div><div class="ttdeci">int u_map_remove_from_value_binary(struct _u_map *u_map, const char *value, size_t length)</div><div class="ttdef"><b>Definition:</b> u_map.c:296</div></div>
<div class="ttc" id="agroup__u__map_html_ga05b3f11fb5b30dfeded798d2f2b7cbd9"><div class="ttname"><a href="group__u__map.html#ga05b3f11fb5b30dfeded798d2f2b7cbd9">u_map_remove_from_key</a></div><div class="ttdeci">int u_map_remove_from_key(struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:246</div></div>
<div class="ttc" id="agroup__u__map_html_ga12122eac6ff17d166455155ea3fcb21b"><div class="ttname"><a href="group__u__map.html#ga12122eac6ff17d166455155ea3fcb21b">u_map_remove_at</a></div><div class="ttdeci">int u_map_remove_at(struct _u_map *u_map, const int index)</div><div class="ttdef"><b>Definition:</b> u_map.c:342</div></div>
<div class="ttc" id="agroup__u__map_html_ga1c6bf1ab52f6290c8c11c246479f2f3f"><div class="ttname"><a href="group__u__map.html#ga1c6bf1ab52f6290c8c11c246479f2f3f">u_map_remove_from_value_case</a></div><div class="ttdeci">int u_map_remove_from_value_case(struct _u_map *u_map, const char *value)</div><div class="ttdef"><b>Definition:</b> u_map.c:319</div></div>
<div class="ttc" id="agroup__u__map_html_ga26b4e475f998a0262e88ca0b201712f9"><div class="ttname"><a href="group__u__map.html#ga26b4e475f998a0262e88ca0b201712f9">u_map_copy</a></div><div class="ttdeci">struct _u_map * u_map_copy(const struct _u_map *source)</div><div class="ttdef"><b>Definition:</b> u_map.c:461</div></div>
<div class="ttc" id="agroup__u__map_html_ga299521474aa3576ac4cbea3709eba438"><div class="ttname"><a href="group__u__map.html#ga299521474aa3576ac4cbea3709eba438">u_map_get_case_length</a></div><div class="ttdeci">ssize_t u_map_get_case_length(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:447</div></div>
<div class="ttc" id="agroup__u__map_html_ga5310869120a986c4956034ecdf0d635a"><div class="ttname"><a href="group__u__map.html#ga5310869120a986c4956034ecdf0d635a">u_map_remove_from_key_case</a></div><div class="ttdeci">int u_map_remove_from_key_case(struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:269</div></div>
<div class="ttc" id="agroup__u__map_html_ga881efcb2a98dd99d3375cd52d8ff06c5"><div class="ttname"><a href="group__u__map.html#ga881efcb2a98dd99d3375cd52d8ff06c5">u_map_has_value</a></div><div class="ttdeci">int u_map_has_value(const struct _u_map *u_map, const char *value)</div><div class="ttdef"><b>Definition:</b> u_map.c:132</div></div>
<div class="ttc" id="agroup__u__map_html_ga8dc8f629b2552c4a8a2be2c9e1a126f3"><div class="ttname"><a href="group__u__map.html#ga8dc8f629b2552c4a8a2be2c9e1a126f3">u_map_has_value_case</a></div><div class="ttdeci">int u_map_has_value_case(const struct _u_map *u_map, const char *value)</div><div class="ttdef"><b>Definition:</b> u_map.c:407</div></div>
<div class="ttc" id="agroup__u__map_html_ga96d481cf8bdd6cd466f5b360751a1a7c"><div class="ttname"><a href="group__u__map.html#ga96d481cf8bdd6cd466f5b360751a1a7c">u_map_clean_enum</a></div><div class="ttdeci">int u_map_clean_enum(char **array)</div><div class="ttdef"><b>Definition:</b> u_map.c:98</div></div>
<div class="ttc" id="agroup__u__map_html_ga9ec83ad81a06506bb9507ebb61823da2"><div class="ttname"><a href="group__u__map.html#ga9ec83ad81a06506bb9507ebb61823da2">u_map_clean_full</a></div><div class="ttdeci">int u_map_clean_full(struct _u_map *u_map)</div><div class="ttdef"><b>Definition:</b> u_map.c:89</div></div>
<div class="ttc" id="agroup__u__map_html_gab241a1b9bbcac7f1af2c7f3a8bb132e0"><div class="ttname"><a href="group__u__map.html#gab241a1b9bbcac7f1af2c7f3a8bb132e0">u_map_enum_keys</a></div><div class="ttdeci">const char ** u_map_enum_keys(const struct _u_map *u_map)</div><div class="ttdef"><b>Definition:</b> u_map.c:112</div></div>
<div class="ttc" id="agroup__u__map_html_gab87926da729050a12664a3dc0c38aed6"><div class="ttname"><a href="group__u__map.html#gab87926da729050a12664a3dc0c38aed6">u_map_has_key_case</a></div><div class="ttdeci">int u_map_has_key_case(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:395</div></div>
<div class="ttc" id="agroup__u__map_html_gac77ddb13f899cf8a414e8e2a35222a7d"><div class="ttname"><a href="group__u__map.html#gac77ddb13f899cf8a414e8e2a35222a7d">u_map_copy_into</a></div><div class="ttdeci">int u_map_copy_into(struct _u_map *dest, const struct _u_map *source)</div><div class="ttdef"><b>Definition:</b> u_map.c:489</div></div>
<div class="ttc" id="agroup__u__map_html_gad1cbdd2ac4cbeb298304d8c949e007df"><div class="ttname"><a href="group__u__map.html#gad1cbdd2ac4cbeb298304d8c949e007df">u_map_put</a></div><div class="ttdeci">int u_map_put(struct _u_map *u_map, const char *key, const char *value)</div><div class="ttdef"><b>Definition:</b> u_map.c:148</div></div>
<div class="ttc" id="agroup__u__map_html_gad4fd82aa40847e950a58c13e5fcf36ce"><div class="ttname"><a href="group__u__map.html#gad4fd82aa40847e950a58c13e5fcf36ce">u_map_has_value_binary</a></div><div class="ttdeci">int u_map_has_value_binary(const struct _u_map *u_map, const char *value, size_t length)</div><div class="ttdef"><b>Definition:</b> u_map.c:136</div></div>
<div class="ttc" id="agroup__u__map_html_gad55e431c22bbb69a455fa39d8b9584dd"><div class="ttname"><a href="group__u__map.html#gad55e431c22bbb69a455fa39d8b9584dd">u_map_enum_values</a></div><div class="ttdeci">const char ** u_map_enum_values(const struct _u_map *u_map)</div><div class="ttdef"><b>Definition:</b> u_map.c:116</div></div>
<div class="ttc" id="agroup__u__map_html_gad61561e48ffa6f7a80f1c15d91606fa8"><div class="ttname"><a href="group__u__map.html#gad61561e48ffa6f7a80f1c15d91606fa8">u_map_has_key</a></div><div class="ttdeci">int u_map_has_key(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:120</div></div>
<div class="ttc" id="agroup__u__map_html_gad9cb68cfafecc2aac92c22730da74715"><div class="ttname"><a href="group__u__map.html#gad9cb68cfafecc2aac92c22730da74715">u_map_remove_from_value</a></div><div class="ttdeci">int u_map_remove_from_value(struct _u_map *u_map, const char *value)</div><div class="ttdef"><b>Definition:</b> u_map.c:292</div></div>
<div class="ttc" id="agroup__u__map_html_gae31d780705f94084efd41128fcde38a1"><div class="ttname"><a href="group__u__map.html#gae31d780705f94084efd41128fcde38a1">u_map_put_binary</a></div><div class="ttdeci">int u_map_put_binary(struct _u_map *u_map, const char *key, const char *value, uint64_t offset, size_t length)</div><div class="ttdef"><b>Definition:</b> u_map.c:156</div></div>
<div class="ttc" id="agroup__u__map_html_gae5d012257f0f6c2d48088d147e1e7f9e"><div class="ttname"><a href="group__u__map.html#gae5d012257f0f6c2d48088d147e1e7f9e">u_map_count</a></div><div class="ttdeci">int u_map_count(const struct _u_map *source)</div><div class="ttdef"><b>Definition:</b> u_map.c:507</div></div>
<div class="ttc" id="agroup__u__map_html_gae971b2cf87da3d5496a60a40aa68f32d"><div class="ttname"><a href="group__u__map.html#gae971b2cf87da3d5496a60a40aa68f32d">u_map_get_case</a></div><div class="ttdeci">const char * u_map_get_case(const struct _u_map *u_map, const char *key)</div><div class="ttdef"><b>Definition:</b> u_map.c:419</div></div>
</div><!-- fragment --><h1>What's new in Ulfius 2.7? <a class="anchor" id="whats-new-in-ulfius-27"></a></h1>
<p>Allow <code>Content-Enconding</code> header with <code>ulfius_send_http_request</code> to compress the response body Add http_compression callback example Add static_compressed_inmemory_website callback example Add callback return value <code>U_CALLBACK_IGNORE</code> to igore incrementation of <code>request-&gt;callback_position</code> Add <code>ulfius_add_websocket_extension_message_perform</code> and <code>ulfius_add_websocket_client_extension_message_perform</code> for advanced websocket extensions management Add <a href="https://tools.ietf.org/html/rfc7692">Compression Extensions for WebSocket</a></p>
<h2>Breaking change with struct _websocket_client_handler</h2>
<p>When declaring a <code>struct _websocket_client_handler</code> for websocket client API, you must initialize its members content to <code>NULL</code> before using it:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>_websocket_client_handler websocket_client_handler = {NULL, NULL};</div>
</div><!-- fragment --><h2>Breaking change with ulfius_set_websocket_response</h2>
<p>When using <code>ulfius_set_websocket_response</code> with parameters <code>websocket_protocol</code> or <code>websocket_extensions</code> set to <code>NULL</code>, Ulfius will no longer accept any protocol or extension sent by the client, but will return no extension nor protocol to the client, and the websocket connexion will be "raw".</p>
<h1>What's new in Ulfius 2.6? <a class="anchor" id="whats-new-in-ulfius-26"></a></h1>
<p>Add IPv6 support.</p>
<p>Add <code>struct _u_request-&gt;callback_position</code> to know the position of the current callback in the callback list.</p>
<h1>What's new in Ulfius 2.5? <a class="anchor" id="whats-new-in-ulfius-25"></a></h1>
<p>Add option to ignore non UTF8 strings in incoming requests.</p>
<p>Allow client certificate authentication</p>
<h1>What's new in Ulfius 2.4? <a class="anchor" id="whats-new-in-ulfius-24"></a></h1>
<p>Improve websocket service features with lots of bugfixes and add the possibility to send a fragmented message.</p>
<p>Add websocket client functionality. Allow to create a websocket client connection and exchange messages with the websocket service. In <code><a href="http://">http://</a></code>/<code>ws://</code> non-secure mode or <code><a href="https://">https://</a></code>/<code>wss://</code> secure mode.</p>
<p>Add a command-line websocket client: <code>uwsc</code>.</p>
<h1>What's new in Ulfius 2.3? <a class="anchor" id="whats-new-in-ulfius-23"></a></h1>
<p>Not much on the API, a lot on the build process. Install via CMake script.</p>
<h1>What's new in Ulfius 2.2? <a class="anchor" id="whats-new-in-ulfius-22"></a></h1>
<p>Allow to use your own callback function when uploading files with <code>ulfius_set_upload_file_callback_function</code>, so a large file can be uploaded, even with the option <code>struct <a class="el" href="struct__u__instance.html#a24a5d7e3bda73eb7f5d5427b8606b12a">_u_instance.max_post_param_size</a></code> set.</p>
<h1>What's new in Ulfius 2.1? <a class="anchor" id="whats-new-in-ulfius-21"></a></h1>
<p>I know it wasn't long since Ulfius 2.0 was released. But after some review and tests, I realized some adjustments had to be made to avoid bugs and to clean the framework a little bit more.</p>
<p>Some of the adjustments made in the new release:</p><ul>
<li>An annoying bug has been fixed that made streaming data a little buggy when used on Raspbian. Now if you don't know the data size you're sending, use the macro U_STREAM_SIZE_UNKNOWN instead of the previous value -1. There is some updates in the stream callback function parameter types. Check the <a href="API.md#streaming-data">streaming data documentation</a>.</li>
<li>Fix bug on <code>ulfius_send_http_request</code> that didn't send back all headers value with the same name (#19)</li>
<li>Fix websocket declaration structures to have them outside of the <code><a class="el" href="ulfius_8h.html" title="Ulfius framework.">ulfius.h</a></code>, because it could lead to horrifying bugs when you compile Ulfius with websocket but add <code>#define U_DISABLE_WEBSOCKET</code> in your application.</li>
<li>Add proxy value for outgoing requests (#18)</li>
<li>Unify and update functions name <code>ulfius_set_[string|json|binary]_body</code>. You may have to update your legacy code.</li>
</ul>
<p>The minor version number has been incremented, from 2.0 to 2.1 because some of the changes may require changes in your own code.</p>
<h1>What's new in Ulfius 2.0? <a class="anchor" id="whats-new-in-ulfius-20"></a></h1>
<p>Ulfius 2.0 brings several changes that make the library incompatible with Ulfius 1.0.x branch. The goal of making Ulfius 2.0 is to make a spring cleaning of some functions, remove what is apparently useless, and should bring bugs and memory loss. The main new features are multiple callback functions and websockets implementation.</p>
<h2>Multiple callback functions <a class="anchor" id="multiple-callback-functions-1"></a></h2>
<p>Instead of having an authentication callback function, then a main callback function, you can now have as much callback functions as you want for the same endpoint. A <code>priority</code> number has been added in the <code>struct <a class="el" href="struct__u__endpoint.html" title="Contains all informations needed for an endpoint.">_u_endpoint</a></code> and the auth_callback function and its dependencies have been removed.</p>
<p>For example, let's say you have the following endpoints defined:</p>
<ul>
<li><code>GET</code> <code>/api/tomato/:tomato</code> =&gt; <code>tomato_get_callback</code> function, priority 10</li>
<li><code>GET</code> <code>/api/potato/:potato</code> =&gt; <code>potato_get_callback</code> function, priority 10</li>
<li><code>GET</code> <code>/api/*</code> =&gt; <code>api_validate_callback</code> function, priority 5</li>
<li><code>*</code> <code>*</code> =&gt; <code>authentication_callback</code> function, priority 1</li>
<li><code>GET</code> <code>*</code> =&gt; <code>gzip_body_callback</code> function, priority 99</li>
</ul>
<p>Then if the client calls the URL <code>GET</code> <code>/api/potato/myPotato</code>, the following callback functions will be called in that order:</p>
<ul>
<li><code>authentication_callback</code></li>
<li><code>api_validate_callback</code></li>
<li><code>potato_get_callback</code></li>
<li><code>gzip_body_callback</code></li>
</ul>
<p><em>Warning:</em> In this example, the URL parameter <code>myPotato</code> will be available only in the <code>potato_get_callback</code> function, because the other endpoints did not defined a URL parameter after <code>/potato</code>.</p>
<p>If you need to communicate between callback functions for any purpose, you can use the new parameter <code>struct <a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code>. This is a <code>void *</code> pointer initialized to <code>NULL</code>.</p>
<p>The dedicated function <code>ulfius_set_response_shared_data</code> can be used to set <code>struct <a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code> and <code>struct <a class="el" href="struct__u__response.html#adc9542bfe43466a49807d7c9e8411b07">_u_response.free_shared_data</a></code>. If <code>struct <a class="el" href="struct__u__response.html#adc9542bfe43466a49807d7c9e8411b07">_u_response.free_shared_data</a></code> is set, the function will be used to free <code>struct <a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code> at the end of the callback list.</p>
<p>Note: If you call <code>ulfius_set_response_shared_data</code> multiple times in the same request, before replacing <code><a class="el" href="struct__u__response.html#af8da57093cc1478ff2e92834b7cdd608">_u_response.shared_data</a></code>, the function <code>ulfius_set_response_shared_data</code> will free the previous pointer with the previous <code>struct <a class="el" href="struct__u__response.html#adc9542bfe43466a49807d7c9e8411b07">_u_response.free_shared_data</a></code> if set.</p>
<h2>Keep only binary_body in struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a> and struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a> <a class="anchor" id="keep-only-binary_body-in-struct-_u_request-and-struct-_u_response"></a></h2>
<p>the values <code>string_body</code> and <code>json_body</code> have been removed from the structures <code>struct <a class="el" href="struct__u__request.html" title="definition of the parameters available in a struct _u_request">_u_request</a></code> and <code>struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code>. This may be painless in the response if you used only the functions <code>ulfius_set_xxx_body_response</code>. Otherwise, you should make small arrangements to your code.</p>
<h2>Websocket service <a class="anchor" id="websocket-service"></a></h2>
<p>Ulfius now allows websockets communication between the client and the server. Check the <a href="API.md#websockets-communication">API.md</a> file for implementation details.</p>
<p>Using websocket requires <a href="https://www.gnutls.org/">libgnutls</a>. It also requires a recent version of <a href="https://www.gnu.org/software/libmicrohttpd/">Libmicrohttpd</a>, at least 0.9.53.</p>
<p>If you don't need or can't use this feature, you can disable it by adding the option <code>WEBSOCKETFLAG=1</code> to the make command when you build Ulfius:</p>
<div class="fragment"><div class="line">$ make WEBSOCKETFLAG=1</div>
</div><!-- fragment --><h2>Remove libjansson and libcurl hard dependency <a class="anchor" id="remove-libjansson-and-libcurl-hard-dependency"></a></h2>
<p>In Ulfius 1.0, libjansson and libcurl were mandatory to build the library, but their usage was not in the core of the framework. Although they can be very useful, so the dependency is now optional.</p>
<p>They are enabled by default, but if you don't need them, you can disable them when you build Ulfius library.</p>
<h3>libjansson dependency <a class="anchor" id="libjansson-dependency"></a></h3>
<p>This dependency allows to use the following functions:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__request__response__cookie.html#ga42e4ff79ea7e40eea5d3ce9128abe9c1">ulfius_get_json_body_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, json_error_t * json_error);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gade63875f40cb95ff87cde09221ff6410">ulfius_set_json_body_request</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, json_t * body);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__request__response__cookie.html#gab8e28e99208b630ee6327e21da22fc9a">ulfius_set_json_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> json_t * body);</div>
<div class="line"> </div>
<div class="line">json_t * <a class="code" href="group__request__response__cookie.html#ga41177752a15dc4248707be238c7e98e4">ulfius_get_json_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, json_error_t * json_error);</div>
</div><!-- fragment --><p>If you want to disable these functions, append <code>JANSSONFLAG=1</code> when you build Ulfius library.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/babelouest/ulfius.git</div>
<div class="line">$ cd ulfius/</div>
<div class="line">$ git submodule update --init</div>
<div class="line">$ make JANSSONFLAG=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h3>libcurl dependency <a class="anchor" id="libjansson-dependency"></a></h3>
<p>This dependency allows to use the following functions:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#gac63db90a4e78f6c86b559c8fb96251e4">ulfius_send_http_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#ga42a42793722765c3bc2848eecf884198">ulfius_send_http_streaming_request</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="struct__u__request.html">_u_request</a> * request, <span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keywordtype">size_t</span> (* write_body_function)(<span class="keywordtype">void</span> * contents, <span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> nmemb, <span class="keywordtype">void</span> * user_data), <span class="keywordtype">void</span> * write_body_data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#ga2403cd5bffb26626a9911f34806aa3e5">ulfius_send_smtp_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * host, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> port, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> use_tls, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">int</span> verify_certificate, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * user, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * password, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * from, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * to, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * cc, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * bcc, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * subject, </div>
<div class="line">                            <span class="keyword">const</span> <span class="keywordtype">char</span> * mail_body);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__http__smtp__client.html#gac07e9171405530b7b13c9b82b4e6845f">ulfius_send_smtp_rich_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * host, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> port, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> use_tls, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">int</span> verify_certificate, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * user, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * password, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * from, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * to, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * cc, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * bcc, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * content_type,</div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * subject, </div>
<div class="line">                                <span class="keyword">const</span> <span class="keywordtype">char</span> * mail_body);</div>
</div><!-- fragment --><p>If you want to disable these functions, append <code>CURLFLAG=1</code> when you build Ulfius library.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/babelouest/ulfius.git</div>
<div class="line">$ cd ulfius/</div>
<div class="line">$ git submodule update --init</div>
<div class="line">$ make CURLFLAG=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><p>If you wan to disable libjansson and libcurl, you can append both parameters.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/babelouest/ulfius.git</div>
<div class="line">$ cd ulfius/</div>
<div class="line">$ git submodule update --init</div>
<div class="line">$ make CURLFLAG=1 JANSSONFLAG=1</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h2>Ready-to-use callback functions <a class="anchor" id="ready-to-use-callback-functions"></a></h2>
<p>You can find some ready-to-use callback functions in the folder <a href="https://github.com/babelouest/ulfius/blob/master/example_callbacks">example_callbacks</a>.</p>
<h1>Update existing programs from Ulfius 2.0 to 2.1 <a class="anchor" id="update-existing-programs-from-ulfius-20-to-21"></a></h1>
<ul>
<li>An annoying bug has been fixed that made streaming data a little buggy when used on Raspbian. Now if you don't know the data size you're sending, use the macro U_STREAM_SIZE_UNKNOWN instead of the previous value -1.</li>
<li>There are some updates in the stream callback function parameter types. Check the <a href="#streaming-data">streaming data documentation</a>.</li>
<li>The websocket data structures are no longer available directly in <code>struct <a class="el" href="struct__u__response.html" title="definition of the parameters available in a struct _u_response">_u_response</a></code> or <code>struct <a class="el" href="struct__u__instance.html" title="Contains the needed data for an ulfius instance to work.">_u_instance</a></code>. But you shouldn't use them like this anyway so it won't be a problem.</li>
<li>Unify and update functions name <code>ulfius_set_*_body_response</code>. You may have to update your legacy code. The new functions names are: <div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#ga71d2fe9c1f110be0dfa07c5ba41680a6">ulfius_set_string_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> * body);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#gaa3e25c671eaa6602b152520f5fd21587">ulfius_set_binary_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> * body, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__parameters.html#gae84451bdf7856760aaf7b096690f5f3f">ulfius_set_empty_body_response</a>(<span class="keyword">struct</span> <a class="code" href="struct__u__response.html">_u_response</a> * response, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> status);</div>
<div class="ttc" id="agroup__parameters_html_gaa3e25c671eaa6602b152520f5fd21587"><div class="ttname"><a href="group__parameters.html#gaa3e25c671eaa6602b152520f5fd21587">ulfius_set_binary_body_response</a></div><div class="ttdeci">int ulfius_set_binary_body_response(struct _u_response *response, const unsigned int status, const char *binary_body, const size_t length)</div><div class="ttdef"><b>Definition:</b> u_response.c:534</div></div>
</div><!-- fragment --></li>
</ul>
<h1>Update existing programs from Ulfius 1.x to 2.0 <a class="anchor" id="update-existing-programs-from-ulfius-1x-to-20"></a></h1>
<p>If you already have programs that use Ulfius 1.x and want to update them to the brand new fresh Ulfius 2.0, it may require the following minor changes.</p>
<h2>Endpoints definitions <a class="anchor" id="endpoints-definitions"></a></h2>
<p>Endpoints structure have changed, <code>ulfius_add_endpoint_by_val</code> now requires only one callback function, but requires a priority number.</p>
<p>If you don't use authentication callback functions, you can simply remove the <code>NULL, NULL, NULL</code> parameters corresponding to the former authentication callback function pointer, the authentication callback user data, and the realm value. Then add any number as a priority, 0 for example.</p>
<p>If you use authentication callback functions, split your <code>ulfius_add_endpoint_by_val</code> call in 2 separate calls, one for the authentication function, one for the main callback function. For example:</p>
<div class="fragment"><div class="line"><span class="comment">// An Ulfius 1.x call</span></div>
<div class="line"><a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(&amp;instance, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, NULL, &amp;auth_callback, my_auth_data, <span class="stringliteral">&quot;my realm&quot;</span>, &amp;main_callback, my_main_data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The same behaviour with Ulfius 2.0</span></div>
<div class="line"><a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(&amp;instance, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, NULL, 0, &amp;auth_callback, my_auth_data);</div>
<div class="line"><a class="code" href="group__endpoints.html#gae11a1bdc65a5d12a356923332e5f4bbc">ulfius_add_endpoint_by_val</a>(&amp;instance, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, NULL, 1, &amp;main_callback, my_main_data);</div>
<div class="line"><span class="comment">// In this case, the realm value &quot;my realm&quot; must be specified in the response</span></div>
</div><!-- fragment --><h2>Callback return value <a class="anchor" id="callback-return-value"></a></h2>
<p>The return value for the callback functions must be adapted, instead of U_OK, U_ERROR or U_ERROR_UNAUTHORIZED, you must use one of the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define U_CALLBACK_CONTINUE     0 </span><span class="comment">// Will replace U_OK</span></div>
<div class="line"><span class="preprocessor">#define U_CALLBACK_IGNORE       1</span></div>
<div class="line"><span class="preprocessor">#define U_CALLBACK_COMPLETE     2</span></div>
<div class="line"><span class="preprocessor">#define U_CALLBACK_UNAUTHORIZED 3 </span><span class="comment">// Will replace U_ERROR_UNAUTHORIZED</span></div>
<div class="line">#define U_CALLBACK_ERROR        4 <span class="comment">// Will replace U_ERROR</span></div>
</div><!-- fragment --><p>If you want more details on the multiple callback functions, check the <a href="#callback-functions-return-value">documentation</a>.</p>
<p>Other functions may have change their name or signature, check the documentation for more information. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
